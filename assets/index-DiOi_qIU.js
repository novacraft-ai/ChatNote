const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PDFViewer-4xV1PfRe.js","assets/vendor-react-BecnK9Vx.js","assets/vendor-DuqZcPz3.js","assets/vendor-C5EChc_d.css","assets/vendor-pdf-DDxsMbbh.js","assets/vendor-react-CBXYWCWZ.css","assets/PDFViewer-CGoqG2CI.css"])))=>i.map(i=>d[i]);
import{r as d,j as e,M as ie,R as ae,a as le}from"./vendor-react-BecnK9Vx.js";import{p as ce}from"./vendor-pdf-DDxsMbbh.js";import{k as de,l as ue,n as he}from"./vendor-DuqZcPz3.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const g of r)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const g={};return r.integrity&&(g.integrity=r.integrity),r.referrerPolicy&&(g.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?g.credentials="include":r.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function p(r){if(r.ep)return;r.ep=!0;const g=s(r);fetch(r.href,g)}})();if(typeof window<"u"){let t;{const p="/ChatNote/";t=`${p.endsWith("/")?p:`${p}/`}pdf.worker.min.js`}const a=p=>{try{if(p)if(!p.GlobalWorkerOptions)p.GlobalWorkerOptions={workerSrc:t};else try{p.GlobalWorkerOptions.workerSrc=t}catch{try{Object.defineProperty(p,"GlobalWorkerOptions",{value:{workerSrc:t},writable:!0,configurable:!0})}catch{}}}catch{}};window.pdfjsLib||(window.pdfjsLib={}),window.pdfjsLib.GlobalWorkerOptions?window.pdfjsLib.GlobalWorkerOptions.workerSrc=t:window.pdfjsLib.GlobalWorkerOptions={workerSrc:t},typeof window.pdfjs>"u"&&(window.pdfjs={}),window.pdfjs.GlobalWorkerOptions?window.pdfjs.GlobalWorkerOptions.workerSrc=t:window.pdfjs.GlobalWorkerOptions={workerSrc:t};const s=ce;if(a(s),s.default&&a(s.default),s.GlobalWorkerOptions)try{s.GlobalWorkerOptions.workerSrc=t}catch{}}const pe="modulepreload",ge=function(t){return"/ChatNote/"+t},X={},me=function(a,s,p){let r=Promise.resolve();if(s&&s.length>0){let f=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),y=m?.nonce||m?.getAttribute("nonce");r=f(s.map(u=>{if(u=ge(u),u in X)return;X[u]=!0;const h=u.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":pe,h||(c.as="script"),c.crossOrigin="",c.href=u,y&&c.setAttribute("nonce",y),document.head.appendChild(c),h)return new Promise((i,o)=>{c.addEventListener("load",i),c.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${u}`)))})}))}function g(m){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=m,window.dispatchEvent(y),!y.defaultPrevented)throw m}return r.then(m=>{for(const y of m||[])y.status==="rejected"&&g(y.reason);return a().catch(g)})},Q=d.createContext(void 0);function fe({children:t}){const[a,s]=d.useState(()=>localStorage.getItem("theme")||"light");d.useEffect(()=>{document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)},[a]);const p=()=>{s(r=>r==="light"?"dark":"light")};return e.jsx(Q.Provider,{value:{theme:a,toggleTheme:p},children:t})}function ee(){const t=d.useContext(Q);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const F=[{id:"openai/gpt-oss-120b",name:"GPT OSS",provider:"OpenAI"},{id:"tngtech/deepseek-r1t2-chimera:free",name:"DeepSeek R1",provider:"DeepSeek"},{id:"deepseek/deepseek-chat-v3.1:free",name:"DeepSeek V3.1",provider:"DeepSeek"},{id:"meta-llama/llama-3.3-70b-instruct:free",name:"Llama 3.3",provider:"Meta"},{id:"qwen/qwen3-235b-a22b:free",name:"Qwen 3",provider:"Qwen"}],xe=F[0].id,R="https://chatnote-backend-8pk3.onrender.com",Y="105659660993-u7lnrcbis23u3mlaigteag67d6h6inar.apps.googleusercontent.com",te=d.createContext(void 0);function ye({children:t}){const[a,s]=d.useState(null),[p,r]=d.useState(!0);d.useEffect(()=>{const f=localStorage.getItem("auth_token");f?g(f):r(!1)},[]);const g=async(f,u=0)=>{let l=!1;try{const c=new AbortController,i=setTimeout(()=>c.abort(),1e4),o=await fetch(`${R}/api/auth/me`,{headers:{Authorization:`Bearer ${f}`},signal:c.signal});if(clearTimeout(i),o.ok){const w=await o.json();s(w.user),l=!0}else if(o.status===401||o.status===403)console.warn("Token invalid, logging out"),localStorage.removeItem("auth_token"),s(null),l=!0;else{if(u<2)return console.warn(`Failed to fetch user (${o.status}), retrying... (${u+1}/2)`),await new Promise(w=>setTimeout(w,1e3*(u+1))),g(f,u+1);console.error("Failed to fetch user after retries, but keeping token:",o.status),l=!0}}catch(c){if(u<2){const i=c instanceof Error?c.name:"Unknown";return console.warn(`Network error (${i}), retrying... (${u+1}/2)`),await new Promise(o=>setTimeout(o,1e3*(u+1))),g(f,u+1)}else c instanceof Error&&c.name==="AbortError"?console.warn("Request timeout after retries, but keeping user logged in"):console.error("Network error fetching user after retries, but keeping token:",c),l=!0}finally{l&&r(!1)}},m=async f=>{try{const u=await fetch(`${R}/api/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:f})});if(!u.ok){const l=await u.json();throw new Error(l.error||"Authentication failed")}const h=await u.json();localStorage.setItem("auth_token",h.token),s(h.user)}catch(u){throw console.error("Login error:",u),u}},y=()=>{localStorage.removeItem("auth_token"),s(null)};return e.jsx(te.Provider,{value:{user:a,loading:p,login:m,logout:y,isAuthenticated:!!a,isAdmin:a?.role==="admin"},children:t})}function U(){const t=d.useContext(te);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function we(){const{user:t,login:a,logout:s,loading:p}=U(),[r,g]=d.useState(!1),[m,y]=d.useState(null);d.useEffect(()=>{const h=console.error,l=console.warn;console.error=(...i)=>{const o=i.join(" ");o.includes("Not signed in with the identity provider")||o.includes("AbortError")||o.includes("signal is aborted")||o.includes("FedCM get() rejects")||o.includes("GSI_LOGGER")||o.includes("Only one navigator.credentials.get request may be outstanding")||h.apply(console,i)},console.warn=(...i)=>{const o=i.join(" ");o.includes("GSI_LOGGER")||o.includes("Not signed in with the identity provider")||o.includes("Only one navigator.credentials.get request may be outstanding")||l.apply(console,i)};const c=window.onerror;return window.onerror=(i,o,w,C,b)=>typeof i=="string"&&(i.includes("Not signed in with the identity provider")||i.includes("Only one navigator.credentials.get request may be outstanding")||i.includes("AbortError")||o?.includes("accounts.google.com"))?!0:c?c(i,o,w,C,b):!1,()=>{console.error=h,console.warn=l,window.onerror=c}},[]);const f=d.useCallback(async h=>{try{await a(h.credential);const l=document.getElementById("google-signin-button");l&&l.remove()}catch(l){console.error("Login failed:",l),alert(l instanceof Error?l.message:"Login failed. Please try again.")}},[a]);d.useEffect(()=>{if(window.google){try{window.google.accounts.id.initialize({client_id:Y,callback:f}),g(!0),setTimeout(()=>{try{window.google?.accounts?.id&&window.google.accounts.id.prompt(c=>{})}catch{}},300)}catch(c){console.error("Failed to initialize Google OAuth:",c),y("Failed to initialize Google OAuth")}return}const h=document.createElement("script");h.src="https://accounts.google.com/gsi/client",h.async=!0,h.defer=!0,h.onload=()=>{if(window.google)try{window.google.accounts.id.initialize({client_id:Y,callback:f,use_fedcm_for_prompt:!0}),g(!0),setTimeout(()=>{try{window.google?.accounts?.id&&window.google.accounts.id.prompt(c=>{})}catch{}},300)}catch(c){console.error("Failed to initialize Google OAuth:",c),y("Failed to initialize Google OAuth")}else console.error("Google script loaded but window.google is not available"),y("Google script failed to load")},h.onerror=()=>{console.error("Failed to load Google Identity Services script"),y("Failed to load Google Sign-In script"),g(!1)};const l=setTimeout(()=>{window.google||(console.error("Google script loading timeout"),y("Google Sign-In is taking too long to load"),g(!1))},1e4);return document.head.appendChild(h),()=>{clearTimeout(l)}},[f]),d.useEffect(()=>{if(t){const h=document.getElementById("google-login-backdrop"),l=document.getElementById("google-signin-button");h&&h.remove(),l&&l.remove()}},[t]);const u=()=>{if(m){alert(`Google Sign-In error: ${m}. Please check the browser console.`);return}if(window.google&&r)try{const h=console.error,l=console.warn;console.error=(...i)=>{const o=i.join(" ");o.includes("AbortError")||o.includes("signal is aborted")||o.includes("FedCM get() rejects")||o.includes("The request has been aborted")||o.includes("403")||o.includes("credential_button_library")||o.includes("The given origin is not allowed")||o.includes("GSI_LOGGER")||typeof i[0]=="string"&&i[0].includes("403")||h.apply(console,i)},console.warn=(...i)=>{const o=i.join(" ");o.includes("Cross-Origin-Opener-Policy")||o.includes("window.postMessage")||o.includes("GSI_LOGGER")||l.apply(console,i)};const c=window.onerror;window.onerror=(i,o,w,C,b)=>typeof i=="string"&&(i.includes("403")||i.includes("credential_button_library")||i.includes("accounts.google.com")||o?.includes("accounts.google.com"))?!0:c?c(i,o,w,C,b):!1,setTimeout(()=>{console.error=h,console.warn=l,window.onerror=c},5e3),window.google.accounts.id.prompt(i=>{const o=i.getNotDisplayedReason?.(),w=i.getSkippedReason?.(),C=i.getDismissedReason?.(),b=i.isNotDisplayed?.(),I=i.isSkippedMoment?.(),A=i.isDismissedMoment?.();if(o||w||C||b||I||A){const G=document.getElementById("google-login-backdrop"),N=document.getElementById("google-signin-button");G&&G.remove(),N&&N.remove();const j=document.createElement("div");j.id="google-login-backdrop",j.style.position="fixed",j.style.top="0",j.style.left="0",j.style.width="100%",j.style.height="100%",j.style.backgroundColor="rgba(0, 0, 0, 0.5)",j.style.zIndex="9999",j.style.display="flex",j.style.alignItems="center",j.style.justifyContent="center";const T=()=>{j.remove(),k.remove(),document.removeEventListener("keydown",L)};j.addEventListener("click",S=>{S.target===j&&T()});const L=S=>{S.key==="Escape"&&T()};document.addEventListener("keydown",L);const k=document.createElement("div");k.id="google-signin-button",k.style.position="relative",k.style.background="white",k.style.padding="20px",k.style.borderRadius="8px",k.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)",k.style.zIndex="10000",k.addEventListener("click",S=>{S.stopPropagation()}),j.appendChild(k),document.body.appendChild(j);try{window.google.accounts.id.renderButton(k,{theme:"outline",size:"large",text:"signin_with",width:250})}catch(S){console.warn("Could not render Google button, showing manual login option:",S),k.innerHTML=`
                <p style="margin: 0 0 10px 0; text-align: center;">Sign in with Google</p>
                <button onclick="window.location.href='https://accounts.google.com/signin'" 
                        style="padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                  Continue with Google
                </button>
                <button onclick="document.getElementById('google-login-backdrop')?.remove(); document.getElementById('google-signin-button')?.remove();" 
                        style="margin-top: 10px; padding: 5px 10px; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                  Cancel
                </button>
              `;const O=k.querySelector("button:last-child");O&&O.addEventListener("click",()=>{document.removeEventListener("keydown",L)})}}})}catch(h){console.error("Error showing Google sign-in:",h);try{window.google.accounts.id.prompt()}catch(l){console.error("Fallback prompt also failed:",l),alert("Failed to show Google Sign-In. Please try refreshing the page.")}}else alert("Google Sign-In is still loading. Please wait a moment and try again.")};return p&&!t?e.jsx("div",{className:"login-button loading",children:e.jsx("span",{children:"Loading..."})}):t?e.jsxs("div",{className:"login-button user-info",children:[e.jsx("div",{className:"user-avatar",children:t.picture?e.jsx("img",{src:t.picture,alt:t.name||t.email,crossOrigin:"anonymous",referrerPolicy:"no-referrer",onError:h=>{const l=h.target;l.style.display="none";const c=l.parentElement;if(c){const i=c.querySelector("span");i&&i.remove();const o=document.createElement("span");o.textContent=t.name?.[0]||t.email[0].toUpperCase(),c.appendChild(o)}}}):e.jsx("span",{children:t.name?.[0]||t.email[0].toUpperCase()})}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:t.name||t.email}),t.role==="admin"&&e.jsx("span",{className:"user-role",children:"Admin"})]}),e.jsx("button",{onClick:s,className:"logout-button",title:"Logout",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})]}):m&&!r?e.jsxs("button",{onClick:u,className:"login-button sign-in error",title:m,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),"Sign in (Error)"]}):e.jsx("button",{onClick:u,className:"login-button sign-in",disabled:!r,title:r?"Sign in with Google":"Loading Google Sign-In...",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"}),e.jsx("path",{d:"M3 20a6 6 0 0 1 6-6h6a6 6 0 0 1 6 6v1H3v-1Z"})]}),"Sign in with Google"]}):e.jsx("span",{children:"Loading Google Sign-In..."})})}async function je(t){const a=await fetch(`${R}/api/user/api-key/status`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Failed to check API key status");return a.json()}async function ke(t,a){const s=await fetch(`${R}/api/user/api-key`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({apiKey:a})});if(!s.ok){const p=await s.json();throw new Error(p.error||"Failed to save API key")}}function ve(){const{user:t,isAdmin:a}=U(),[s,p]=d.useState(""),[r,g]=d.useState(!1),[m,y]=d.useState(!1),[f,u]=d.useState(!1),[h,l]=d.useState(null);d.useEffect(()=>{t&&!a?c():a&&g(!0)},[t,a]);const c=async()=>{if(t){y(!0);try{const o=localStorage.getItem("auth_token");if(!o)return;const w=await je(o);g(w.hasApiKey)}catch(o){console.error("Failed to load API key status:",o)}finally{y(!1)}}},i=async()=>{if(!(!t||!s.trim())){u(!0),l(null);try{const o=localStorage.getItem("auth_token");if(!o)throw new Error("Not authenticated");await ke(o,s.trim()),l({type:"success",text:"API key saved securely!"}),p(""),g(!0)}catch(o){l({type:"error",text:o instanceof Error?o.message:"Failed to save API key"})}finally{u(!1)}}};return t?a?e.jsx("div",{className:"api-key-settings",children:e.jsxs("div",{className:"api-key-info admin",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"api-key-title",children:"Admin Account"}),e.jsx("p",{className:"api-key-description",children:"You're using the admin API key. No configuration needed."})]})]})}):m?e.jsx("div",{className:"api-key-settings",children:e.jsx("p",{className:"api-key-message",children:"Loading..."})}):e.jsxs("div",{className:"api-key-settings",children:[e.jsxs("div",{className:"api-key-header",children:[e.jsx("h3",{children:"OpenRouter API Key"}),r&&e.jsx("span",{className:"api-key-status-badge",children:"Configured"})]}),e.jsx("p",{className:"api-key-description",children:r?"Your API key is securely stored and encrypted. You can update it below.":"Enter your OpenRouter API key to use the chat feature. Your key will be encrypted and stored securely."}),e.jsxs("div",{className:"api-key-input-group",children:[e.jsx("input",{type:"password",value:s,onChange:o=>p(o.target.value),placeholder:"sk-or-v1-...",className:"api-key-input",disabled:f}),e.jsx("button",{onClick:i,disabled:!s.trim()||f,className:"api-key-save-button",children:f?"Saving...":r?"Update":"Save"})]}),h&&e.jsx("div",{className:`api-key-message ${h.type}`,children:h.text}),e.jsxs("div",{className:"api-key-help",children:[e.jsx("p",{children:e.jsx("strong",{children:"Don't have an API key?"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",children:"OpenRouter"})]}),e.jsx("li",{children:"Sign up or log in"}),e.jsx("li",{children:"Create a new API key"}),e.jsx("li",{children:"Copy and paste it here"})]}),e.jsx("p",{className:"api-key-security-note",children:"ðŸ”’ Your API key is encrypted with AES-256 and stored securely. Only you can use it."})]})]}):e.jsx("div",{className:"api-key-settings",children:e.jsx("p",{className:"api-key-message",children:"Please sign in to configure your API key."})})}function be(){const{theme:t,toggleTheme:a}=ee(),[s,p]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"navbar",children:e.jsxs("div",{className:"navbar-content",children:[e.jsx("h1",{className:"navbar-title",children:"ChatNote"}),e.jsxs("div",{className:"navbar-actions",children:[e.jsx(we,{}),e.jsx("button",{className:"settings-toggle",onClick:()=>p(!s),title:"Settings","aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"})]})}),e.jsx("button",{className:"theme-toggle",onClick:a,title:`Switch to ${t==="light"?"dark":"light"} mode`,"aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})]})]})}),s&&e.jsx("div",{className:"settings-modal-overlay",onClick:()=>p(!1),children:e.jsxs("div",{className:"settings-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"settings-modal-header",children:[e.jsx("h2",{children:"Settings"}),e.jsx("button",{className:"settings-modal-close",onClick:()=>p(!1),"aria-label":"Close settings",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"settings-modal-content",children:e.jsx(ve,{})})]})})]})}function ne(){return localStorage.getItem("auth_token")}async function Se(t,a,s,p){const r=ne();if(!r)throw new Error("Authentication required. Please log in.");try{const g={messages:t,context:a,model:p||"openai/gpt-oss-120b",temperature:.7,maxTokens:3e3,stream:!!s},m=await fetch(`${R}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(g)});if(!m.ok){const f=await m.json().catch(()=>({error:{message:"Unknown error"}}));throw m.status===401?(localStorage.removeItem("auth_token"),new Error("Session expired. Please log in again.")):m.status===400&&f.error?.includes("API key not configured")?new Error("API key not configured. Please add your OpenRouter API key in settings."):new Error(f.error?.message||`API request failed with status ${m.status}`)}if(s&&m.body){const f=m.body.getReader(),u=new TextDecoder;let h="",l="";for(;;){const{done:c,value:i}=await f.read();if(c)break;l+=u.decode(i,{stream:!0});const o=l.split(`
`);l=o.pop()||"";for(const w of o){const C=w.trim();if(C&&C.startsWith("data: ")){const b=C.slice(6);if(b==="[DONE]")continue;try{const A=JSON.parse(b).choices?.[0]?.delta?.content||"";A&&(h+=A,s(A))}catch(I){console.warn("Failed to parse streaming chunk:",I)}}}}if(l.trim()){const c=l.trim();if(c.startsWith("data: ")){const i=c.slice(6);if(i!=="[DONE]")try{const w=JSON.parse(i).choices?.[0]?.delta?.content||"";w&&(h+=w,s(w))}catch{}}}return h}return(await m.json()).choices[0]?.message?.content||"No response from API"}catch(g){throw console.error("Chat service error:",g),g}}async function Ne(){const t=ne();if(!t)return!1;try{const a=await fetch(`${R}/api/user/api-key/status`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const s=await a.json();return s.hasApiKey||s.isAdmin}return!1}catch{return!1}}function Ee(t){const a=/\[\s*\n*\s*((?:[^[\]]*\\[a-zA-Z@]+[^[\]]*)+)\s*\n*\s*\]/g;return t.replace(a,(s,p)=>/\\[a-zA-Z@]+/.test(p)?`\\[${p.trim().replace(/\n\s*\n+/g,`
`).replace(/^\s+|\s+$/gm,"")}\\]`:s)}function Ce({selectedText:t,onToggleLayout:a,layout:s}){const{theme:p}=ee(),{isAuthenticated:r,user:g,loading:m}=U(),[y,f]=d.useState([]),[u,h]=d.useState(""),[l,c]=d.useState(!1),[i,o]=d.useState(null),[w,C]=d.useState(!0),[b,I]=d.useState(!0),[A,G]=d.useState(xe),[N,j]=d.useState(!1),T=d.useRef(null),L=d.useRef(null),k=d.useRef(null),S=d.useRef(null),O=d.useRef(null),[B,$]=d.useState(null),K=()=>{T.current?.scrollIntoView({behavior:"smooth"})},_=()=>{const n=L.current;if(n){n.style.height="auto";const E=Math.min(Math.max(n.scrollHeight,24),200);n.style.height=`${E}px`}};d.useEffect(()=>{K()},[y]),d.useEffect(()=>{L.current?.focus(),_()},[]),d.useEffect(()=>{const n=setTimeout(()=>{_()},0);return()=>clearTimeout(n)},[u]),d.useEffect(()=>{(async()=>{if(r){const x=await Ne();C(!x)}else C(!0)})()},[r,g]),d.useEffect(()=>{s==="split"&&I(!1)},[s]),d.useEffect(()=>{if(!N){$(null);return}const n=()=>{if(S.current){const W=S.current.getBoundingClientRect(),P=Math.max(W.width,220);$({width:P})}};n();const x=setTimeout(n,10),v=requestAnimationFrame(n),E=setTimeout(n,50);return window.addEventListener("scroll",n,!0),window.addEventListener("resize",n),()=>{clearTimeout(x),clearTimeout(E),cancelAnimationFrame(v),window.removeEventListener("scroll",n,!0),window.removeEventListener("resize",n)}},[N]),d.useEffect(()=>{if(!N)return;const n=v=>{const E=v.target;S.current&&O.current&&!S.current.contains(E)&&!O.current.contains(E)&&j(!1)},x=setTimeout(()=>{document.addEventListener("mousedown",n)},100);return()=>{clearTimeout(x),document.removeEventListener("mousedown",n)}},[N]);const q=n=>{G(n),j(!1)},V=()=>{if(w)return"Select Model";const n=F.find(x=>x.id===A);return n?n.name:"Select Model"},Z=async()=>{const n=u.trim();if(!n&&!t)return;if(!r){o("Please sign in to use the chat feature.");return}if(w){o("Please configure your OpenRouter API key in Settings.");return}b&&I(!1),k.current&&k.current.abort(),k.current=new AbortController;let x=n;t&&!n?x=`Tell me about this: ${t}`:t&&n&&(x=`${n}

Context from PDF: ${t}`);const v={id:Date.now().toString(),role:"user",content:x};f(P=>[...P,v]),h(""),setTimeout(()=>{_()},0),c(!0),o(null);const E=(Date.now()+1).toString(),W={id:E,role:"assistant",content:""};f(P=>[...P,W]);try{const P=y.slice(-10).map(M=>({role:M.role,content:M.content}));let D="";await Se([...P,v],t&&!n?t:void 0,M=>{D+=M,f(re=>re.map(z=>z.id===E?{...z,content:D}:z)),K()},A)}catch(P){console.error("Error sending message:",P),o(P instanceof Error?P.message:"Failed to send message"),f(D=>D.filter(M=>M.id!==E))}finally{c(!1),k.current=null,L.current?.focus()}},oe=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),Z())},se=()=>{t&&(h(`Tell me about this: ${t}`),L.current?.focus())},J=()=>{f([]),o(null)};return e.jsxs("div",{className:"chatgpt-wrapper",children:[!m&&!r&&s==="floating"&&e.jsxs("div",{className:"api-key-warning-outer",children:[e.jsx("span",{children:"ðŸ” Please sign in to use the chat feature"}),e.jsx("span",{className:"warning-hint",children:'Click "Sign in with Google" in the navigation bar'})]}),!m&&r&&w&&s==="floating"&&e.jsxs("div",{className:"api-key-warning-outer",children:[e.jsx("span",{children:"âš ï¸ OpenRouter API key not configured"}),e.jsx("span",{className:"warning-hint",children:g?.role==="admin"?"Admin API key not configured on server":"Add your API key in Settings (click the gear icon)"})]}),s==="floating"&&e.jsxs("div",{className:`model-selector-bar ${p==="dark"?"theme-dark":"theme-light"}`,children:[e.jsxs("div",{className:"model-selector-wrapper",ref:S,children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const x=!N;j(x),x||$(null)},className:"model-selector-button",title:"Select AI model",disabled:w,children:[e.jsx("span",{className:"model-selector-text",children:V()}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:N?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]}),N&&e.jsx("div",{ref:O,className:"model-selector-dropdown",onClick:n=>n.stopPropagation(),onMouseDown:n=>n.stopPropagation(),style:B?{width:`${B.width}px`}:void 0,children:F.map(n=>e.jsxs("button",{type:"button",onClick:x=>{x.preventDefault(),x.stopPropagation(),q(n.id)},className:`model-option ${A===n.id?"selected":""}`,children:[e.jsxs("div",{className:"model-option-content",children:[e.jsx("span",{className:"model-option-name",children:n.name}),e.jsx("span",{className:"model-option-provider",children:n.provider})]}),A===n.id&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]},n.id))})]}),e.jsxs("div",{className:"header-actions",children:[y.length>0&&e.jsx("button",{onClick:J,className:"clear-button",title:"Clear chat",children:"Clear"}),s==="floating"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a,className:"layout-toggle-button",title:s==="floating"?"Switch to split layout":"Switch to floating layout","aria-label":s==="floating"?"Switch to split layout":"Switch to floating layout",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s==="floating"?e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("line",{x1:"10",y1:"3",x2:"10",y2:"10"}),e.jsx("line",{x1:"3",y1:"10",x2:"10",y2:"10"})]}):e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]})})}),e.jsx("button",{onClick:()=>I(!b),className:"collapse-button",title:b?"Expand chat":"Collapse chat","aria-label":b?"Expand chat":"Collapse chat",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:b?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M18 15l-6-6-6 6"})})})]})]})]}),e.jsxs("div",{className:`chatgpt-inner ${p==="dark"?"theme-dark":"theme-light"} ${b&&s==="floating"?"collapsed":""}`,children:[t&&e.jsxs("div",{className:"selected-text-banner",children:[e.jsx("span",{className:"banner-text",children:"Selected text available"}),e.jsx("button",{onClick:se,className:"use-text-button",children:"Use in chat"})]}),(!b||s==="split")&&e.jsxs("div",{className:"chatgpt-messages",children:[y.length===0&&e.jsxs("div",{className:"welcome-screen",children:[e.jsx("div",{className:"welcome-icon",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"#10a37f",opacity:"0.1"}),e.jsx("path",{d:"M6 9H18M6 13H14",stroke:"#10a37f",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("h3",{children:"How can I help you today?"}),e.jsx("p",{children:"Ask me anything about your PDF, or select text to get context-specific answers."})]}),y.map(n=>e.jsxs("div",{className:`message ${n.role==="user"?"message-user":"message-assistant"}`,children:[e.jsx("div",{className:"message-avatar",children:n.role==="user"?e.jsx("div",{className:"avatar-user",children:"U"}):e.jsx("div",{className:"avatar-assistant",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"currentColor"})})})}),e.jsx("div",{className:"message-content-wrapper",children:e.jsx("div",{className:"message-content",children:n.role==="assistant"&&l&&!n.content?e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):n.role==="assistant"&&n.content?e.jsx("div",{className:"markdown-content",children:e.jsx(ie,{remarkPlugins:[ue,he],rehypePlugins:[de],components:{table:({children:x,...v})=>e.jsx("div",{className:"table-scroll-wrapper",children:e.jsx("table",{...v,children:x})}),div:({children:x,className:v,...E})=>v&&(v.includes("katex-display")||v.includes("math-display"))?e.jsx("div",{className:`math-scroll-wrapper ${v}`,...E,children:x}):e.jsx("div",{...E,className:v,children:x}),pre:({children:x,...v})=>e.jsx("pre",{className:"code-scroll-wrapper",...v,children:x})},children:Ee(n.content)})}):e.jsx("div",{className:"markdown-content",children:n.content})})})]},n.id)),i&&e.jsxs("div",{className:"error-message",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("div",{className:"error-text",children:i})]}),e.jsx("div",{ref:T})]}),!m&&!r&&s==="split"&&e.jsxs("div",{className:"api-key-warning-split-top",children:[e.jsx("span",{children:"ðŸ” Please sign in to use the chat feature"}),e.jsx("span",{className:"warning-hint",children:'Click "Sign in with Google" in the navigation bar'})]}),!m&&r&&w&&s==="split"&&e.jsxs("div",{className:"api-key-warning-split-top",children:[e.jsx("span",{children:"âš ï¸ OpenRouter API key not configured"}),e.jsx("span",{className:"warning-hint",children:g?.role==="admin"?"Admin API key not configured on server":"Add your API key in Settings (click the gear icon)"})]}),s==="split"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`model-selector-bar ${p==="dark"?"theme-dark":"theme-light"}`,children:[e.jsxs("div",{className:"model-selector-wrapper",ref:S,children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const x=!N;j(x),x||$(null)},className:"model-selector-button",title:"Select AI model",disabled:w||!r,children:[e.jsx("span",{className:"model-selector-text",children:V()}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:N?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]}),N&&e.jsx("div",{ref:O,className:"model-selector-dropdown",onClick:n=>n.stopPropagation(),onMouseDown:n=>n.stopPropagation(),style:B?{width:`${B.width}px`}:void 0,children:F.map(n=>e.jsxs("button",{type:"button",onClick:x=>{x.preventDefault(),x.stopPropagation(),q(n.id)},className:`model-option ${A===n.id?"selected":""}`,children:[e.jsxs("div",{className:"model-option-content",children:[e.jsx("span",{className:"model-option-name",children:n.name}),e.jsx("span",{className:"model-option-provider",children:n.provider})]}),A===n.id&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]},n.id))})]}),y.length>0&&e.jsx("button",{onClick:J,className:"clear-button",title:"Clear chat",children:"Clear"}),e.jsx("button",{onClick:a,className:"layout-toggle-button",title:"Switch to floating layout","aria-label":"Switch to floating layout",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("line",{x1:"10",y1:"3",x2:"10",y2:"10"}),e.jsx("line",{x1:"3",y1:"10",x2:"10",y2:"10"})]})})]}),e.jsx("div",{className:`footer-text-outer split-footer ${p==="dark"?"theme-dark":"theme-light"}`,children:e.jsx("span",{className:"footer-text",children:"AI responses may contain errors. Please verify important information."})})]}),e.jsx("div",{className:"chatgpt-input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx("textarea",{ref:L,value:u,onChange:n=>h(n.target.value),onKeyPress:oe,placeholder:"Ask a question...",rows:1,className:"chatgpt-input",disabled:l||w||!r}),e.jsx("button",{onClick:Z,disabled:!u.trim()&&!t||l||w||!r,className:"send-button",title:"Send message",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})]}),s==="floating"&&e.jsx("div",{className:`footer-text-outer ${p==="dark"?"theme-dark":"theme-light"}`,children:e.jsx("span",{className:"footer-text",children:"AI responses may contain errors. Please verify important information."})})]})}class Ae extends d.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#666",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{maxWidth:"400px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"PDF Viewer Temporarily Unavailable"}),e.jsx("p",{style:{marginBottom:"20px"},children:"There's a configuration issue with the PDF viewer. The rest of the app is working fine!"}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",marginBottom:"20px"},children:["Error: ",this.state.error?.message||"Unknown error"]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("label",{htmlFor:"pdf-upload-fallback",style:{padding:"12px 24px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:"pointer",display:"inline-block"},children:"Upload PDF (Basic)"}),e.jsx("input",{id:"pdf-upload-fallback",type:"file",accept:"application/pdf",onChange:a=>{const s=a.target.files?.[0];s&&alert(`PDF "${s.name}" selected. PDF viewing will work once the configuration issue is resolved.`)},style:{display:"none"}})]}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Try Again"})]})}):this.props.children}}const Pe=d.lazy(()=>me(()=>import("./PDFViewer-4xV1PfRe.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Le(){const[t,a]=d.useState(null),[s,p]=d.useState(""),[r,g]=d.useState("floating"),m=u=>{a(u)},y=u=>{p(u)},f=()=>{g(u=>u==="floating"?"split":"floating")};return e.jsx(fe,{children:e.jsx(ye,{children:e.jsxs("div",{className:"app",children:[e.jsx(be,{}),e.jsxs("div",{className:`main-content ${r==="split"?"split-layout":""}`,children:[e.jsx(Ae,{children:e.jsx(d.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading PDF viewer..."}),children:e.jsx(Pe,{file:t,onFileUpload:m,onTextSelection:y,layout:r})})}),e.jsx("div",{className:`chat-container ${r==="floating"?"floating-chat":"split-chat"}`,children:e.jsx(Ce,{selectedText:s,onToggleLayout:f,layout:r})})]})]})})})}const H=document.getElementById("root");if(!H)throw new Error("Root element not found");try{ae.createRoot(H).render(e.jsx(le.StrictMode,{children:e.jsx(Le,{})}))}catch(t){H.innerHTML=`
    <div style="padding: 20px; color: red;">
      <h1>Error Loading App</h1>
      <p>${t instanceof Error?t.message:String(t)}</p>
      <p>Check the browser console for more details.</p>
    </div>
  `}
