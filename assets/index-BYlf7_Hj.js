const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PDFViewer-BpxVOLHw.js","assets/vendor-react-BecnK9Vx.js","assets/vendor-DuqZcPz3.js","assets/vendor-C5EChc_d.css","assets/vendor-pdf-DDxsMbbh.js","assets/vendor-react-CBXYWCWZ.css","assets/PDFViewer-BGNy3bfx.css"])))=>i.map(i=>d[i]);
import{r as d,j as e,M as re,R as ie,a as ae}from"./vendor-react-BecnK9Vx.js";import{p as le}from"./vendor-pdf-DDxsMbbh.js";import{k as ce,l as de,n as ue}from"./vendor-DuqZcPz3.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const g of r)if(g.type==="childList")for(const m of g.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const g={};return r.integrity&&(g.integrity=r.integrity),r.referrerPolicy&&(g.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?g.credentials="include":r.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function p(r){if(r.ep)return;r.ep=!0;const g=s(r);fetch(r.href,g)}})();if(typeof window<"u"){let t;{const p="/ChatNote/";t=`${p.endsWith("/")?p:`${p}/`}pdf.worker.min.js`}const a=p=>{try{if(p)if(!p.GlobalWorkerOptions)p.GlobalWorkerOptions={workerSrc:t};else try{p.GlobalWorkerOptions.workerSrc=t}catch{try{Object.defineProperty(p,"GlobalWorkerOptions",{value:{workerSrc:t},writable:!0,configurable:!0})}catch{}}}catch{}};window.pdfjsLib||(window.pdfjsLib={}),window.pdfjsLib.GlobalWorkerOptions?window.pdfjsLib.GlobalWorkerOptions.workerSrc=t:window.pdfjsLib.GlobalWorkerOptions={workerSrc:t},typeof window.pdfjs>"u"&&(window.pdfjs={}),window.pdfjs.GlobalWorkerOptions?window.pdfjs.GlobalWorkerOptions.workerSrc=t:window.pdfjs.GlobalWorkerOptions={workerSrc:t};const s=le;if(a(s),s.default&&a(s.default),s.GlobalWorkerOptions)try{s.GlobalWorkerOptions.workerSrc=t}catch{}}const he="modulepreload",pe=function(t){return"/ChatNote/"+t},J={},ge=function(a,s,p){let r=Promise.resolve();if(s&&s.length>0){let x=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),y=m?.nonce||m?.getAttribute("nonce");r=x(s.map(u=>{if(u=pe(u),u in J)return;J[u]=!0;const h=u.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":he,h||(c.as="script"),c.crossOrigin="",c.href=u,y&&c.setAttribute("nonce",y),document.head.appendChild(c),h)return new Promise((i,o)=>{c.addEventListener("load",i),c.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${u}`)))})}))}function g(m){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=m,window.dispatchEvent(y),!y.defaultPrevented)throw m}return r.then(m=>{for(const y of m||[])y.status==="rejected"&&g(y.reason);return a().catch(g)})},Y=d.createContext(void 0);function me({children:t}){const[a,s]=d.useState(()=>localStorage.getItem("theme")||"light");d.useEffect(()=>{document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)},[a]);const p=()=>{s(r=>r==="light"?"dark":"light")};return e.jsx(Y.Provider,{value:{theme:a,toggleTheme:p},children:t})}function Q(){const t=d.useContext(Y);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const D=[{id:"openai/gpt-oss-120b",name:"GPT OSS",provider:"OpenAI"},{id:"tngtech/deepseek-r1t2-chimera:free",name:"DeepSeek R1",provider:"DeepSeek"},{id:"deepseek/deepseek-chat-v3.1:free",name:"DeepSeek V3.1",provider:"DeepSeek"},{id:"meta-llama/llama-3.3-70b-instruct:free",name:"Llama 3.3",provider:"Meta"},{id:"qwen/qwen3-235b-a22b:free",name:"Qwen 3",provider:"Qwen"}],fe=D[0].id,G="https://chatnote-backend-8pk3.onrender.com",X="105659660993-u7lnrcbis23u3mlaigteag67d6h6inar.apps.googleusercontent.com",ee=d.createContext(void 0);function xe({children:t}){const[a,s]=d.useState(null),[p,r]=d.useState(!0);d.useEffect(()=>{const x=localStorage.getItem("auth_token");x?g(x):r(!1)},[]);const g=async(x,u=0)=>{let l=!1;try{const c=new AbortController,i=setTimeout(()=>c.abort(),1e4),o=await fetch(`${G}/api/auth/me`,{headers:{Authorization:`Bearer ${x}`},signal:c.signal});if(clearTimeout(i),o.ok){const w=await o.json();s(w.user),l=!0}else if(o.status===401||o.status===403)console.warn("Token invalid, logging out"),localStorage.removeItem("auth_token"),s(null),l=!0;else{if(u<2)return console.warn(`Failed to fetch user (${o.status}), retrying... (${u+1}/2)`),await new Promise(w=>setTimeout(w,1e3*(u+1))),g(x,u+1);console.error("Failed to fetch user after retries, but keeping token:",o.status),l=!0}}catch(c){if(u<2){const i=c instanceof Error?c.name:"Unknown";return console.warn(`Network error (${i}), retrying... (${u+1}/2)`),await new Promise(o=>setTimeout(o,1e3*(u+1))),g(x,u+1)}else c instanceof Error&&c.name==="AbortError"?console.warn("Request timeout after retries, but keeping user logged in"):console.error("Network error fetching user after retries, but keeping token:",c),l=!0}finally{l&&r(!1)}},m=async x=>{try{const u=await fetch(`${G}/api/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:x})});if(!u.ok){const l=await u.json();throw new Error(l.error||"Authentication failed")}const h=await u.json();localStorage.setItem("auth_token",h.token),s(h.user)}catch(u){throw console.error("Login error:",u),u}},y=()=>{localStorage.removeItem("auth_token"),s(null)};return e.jsx(ee.Provider,{value:{user:a,loading:p,login:m,logout:y,isAuthenticated:!!a,isAdmin:a?.role==="admin"},children:t})}function H(){const t=d.useContext(ee);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function ye(){const{user:t,login:a,logout:s,loading:p}=H(),[r,g]=d.useState(!1),[m,y]=d.useState(null);d.useEffect(()=>{const h=console.error,l=console.warn;console.error=(...i)=>{const o=i.join(" ");o.includes("Not signed in with the identity provider")||o.includes("AbortError")||o.includes("signal is aborted")||o.includes("FedCM get() rejects")||o.includes("GSI_LOGGER")||o.includes("Only one navigator.credentials.get request may be outstanding")||h.apply(console,i)},console.warn=(...i)=>{const o=i.join(" ");o.includes("GSI_LOGGER")||o.includes("Not signed in with the identity provider")||o.includes("Only one navigator.credentials.get request may be outstanding")||l.apply(console,i)};const c=window.onerror;return window.onerror=(i,o,w,v,E)=>typeof i=="string"&&(i.includes("Not signed in with the identity provider")||i.includes("Only one navigator.credentials.get request may be outstanding")||i.includes("AbortError")||o?.includes("accounts.google.com"))?!0:c?c(i,o,w,v,E):!1,()=>{console.error=h,console.warn=l,window.onerror=c}},[]);const x=d.useCallback(async h=>{try{await a(h.credential);const l=document.getElementById("google-signin-button");l&&l.remove()}catch(l){console.error("Login failed:",l),alert(l instanceof Error?l.message:"Login failed. Please try again.")}},[a]);d.useEffect(()=>{if(window.google){try{window.google.accounts.id.initialize({client_id:X,callback:x}),g(!0),setTimeout(()=>{try{window.google?.accounts?.id&&window.google.accounts.id.prompt(c=>{})}catch{}},300)}catch(c){console.error("Failed to initialize Google OAuth:",c),y("Failed to initialize Google OAuth")}return}const h=document.createElement("script");h.src="https://accounts.google.com/gsi/client",h.async=!0,h.defer=!0,h.onload=()=>{if(window.google)try{window.google.accounts.id.initialize({client_id:X,callback:x,use_fedcm_for_prompt:!0}),g(!0),setTimeout(()=>{try{window.google?.accounts?.id&&window.google.accounts.id.prompt(c=>{})}catch{}},300)}catch(c){console.error("Failed to initialize Google OAuth:",c),y("Failed to initialize Google OAuth")}else console.error("Google script loaded but window.google is not available"),y("Google script failed to load")},h.onerror=()=>{console.error("Failed to load Google Identity Services script"),y("Failed to load Google Sign-In script"),g(!1)};const l=setTimeout(()=>{window.google||(console.error("Google script loading timeout"),y("Google Sign-In is taking too long to load"),g(!1))},1e4);return document.head.appendChild(h),()=>{clearTimeout(l)}},[x]),d.useEffect(()=>{if(t){const h=document.getElementById("google-login-backdrop"),l=document.getElementById("google-signin-button");h&&h.remove(),l&&l.remove()}},[t]);const u=()=>{if(m){alert(`Google Sign-In error: ${m}. Please check the browser console.`);return}if(window.google&&r)try{const h=console.error,l=console.warn;console.error=(...i)=>{const o=i.join(" ");o.includes("AbortError")||o.includes("signal is aborted")||o.includes("FedCM get() rejects")||o.includes("The request has been aborted")||o.includes("403")||o.includes("credential_button_library")||o.includes("The given origin is not allowed")||o.includes("GSI_LOGGER")||typeof i[0]=="string"&&i[0].includes("403")||h.apply(console,i)},console.warn=(...i)=>{const o=i.join(" ");o.includes("Cross-Origin-Opener-Policy")||o.includes("window.postMessage")||o.includes("GSI_LOGGER")||l.apply(console,i)};const c=window.onerror;window.onerror=(i,o,w,v,E)=>typeof i=="string"&&(i.includes("403")||i.includes("credential_button_library")||i.includes("accounts.google.com")||o?.includes("accounts.google.com"))?!0:c?c(i,o,w,v,E):!1,setTimeout(()=>{console.error=h,console.warn=l,window.onerror=c},5e3),window.google.accounts.id.prompt(i=>{const o=i.getNotDisplayedReason?.(),w=i.getSkippedReason?.(),v=i.getDismissedReason?.(),E=i.isNotDisplayed?.(),A=i.isSkippedMoment?.(),O=i.isDismissedMoment?.();if(o||w||v||E||A||O){const S=document.getElementById("google-login-backdrop"),M=document.getElementById("google-signin-button");S&&S.remove(),M&&M.remove();const k=document.createElement("div");k.id="google-login-backdrop",k.style.position="fixed",k.style.top="0",k.style.left="0",k.style.width="100%",k.style.height="100%",k.style.backgroundColor="rgba(0, 0, 0, 0.5)",k.style.zIndex="9999",k.style.display="flex",k.style.alignItems="center",k.style.justifyContent="center";const L=()=>{k.remove(),j.remove(),document.removeEventListener("keydown",I)};k.addEventListener("click",C=>{C.target===k&&L()});const I=C=>{C.key==="Escape"&&L()};document.addEventListener("keydown",I);const j=document.createElement("div");j.id="google-signin-button",j.style.position="relative",j.style.background="white",j.style.padding="20px",j.style.borderRadius="8px",j.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)",j.style.zIndex="10000",j.addEventListener("click",C=>{C.stopPropagation()}),k.appendChild(j),document.body.appendChild(k);try{window.google.accounts.id.renderButton(j,{theme:"outline",size:"large",text:"signin_with",width:250})}catch(C){console.warn("Could not render Google button, showing manual login option:",C),j.innerHTML=`
                <p style="margin: 0 0 10px 0; text-align: center;">Sign in with Google</p>
                <button onclick="window.location.href='https://accounts.google.com/signin'" 
                        style="padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                  Continue with Google
                </button>
                <button onclick="document.getElementById('google-login-backdrop')?.remove(); document.getElementById('google-signin-button')?.remove();" 
                        style="margin-top: 10px; padding: 5px 10px; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                  Cancel
                </button>
              `;const R=j.querySelector("button:last-child");R&&R.addEventListener("click",()=>{document.removeEventListener("keydown",I)})}}})}catch(h){console.error("Error showing Google sign-in:",h);try{window.google.accounts.id.prompt()}catch(l){console.error("Fallback prompt also failed:",l),alert("Failed to show Google Sign-In. Please try refreshing the page.")}}else alert("Google Sign-In is still loading. Please wait a moment and try again.")};return p&&!t?e.jsx("div",{className:"login-button loading",children:e.jsx("span",{children:"Loading..."})}):t?e.jsxs("div",{className:"login-button user-info",children:[e.jsx("div",{className:"user-avatar",children:t.picture?e.jsx("img",{src:t.picture,alt:t.name||t.email,crossOrigin:"anonymous",referrerPolicy:"no-referrer",onError:h=>{const l=h.target;l.style.display="none";const c=l.parentElement;if(c){const i=c.querySelector("span");i&&i.remove();const o=document.createElement("span");o.textContent=t.name?.[0]||t.email[0].toUpperCase(),c.appendChild(o)}}}):e.jsx("span",{children:t.name?.[0]||t.email[0].toUpperCase()})}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:t.name||t.email}),t.role==="admin"&&e.jsx("span",{className:"user-role",children:"Admin"})]}),e.jsx("button",{onClick:s,className:"logout-button",title:"Logout",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})]}):m&&!r?e.jsxs("button",{onClick:u,className:"login-button sign-in error",title:m,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),"Sign in (Error)"]}):e.jsx("button",{onClick:u,className:"login-button sign-in",disabled:!r,title:r?"Sign in with Google":"Loading Google Sign-In...",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"}),e.jsx("path",{d:"M3 20a6 6 0 0 1 6-6h6a6 6 0 0 1 6 6v1H3v-1Z"})]}),"Sign in with Google"]}):e.jsx("span",{children:"Loading Google Sign-In..."})})}async function we(t){const a=await fetch(`${G}/api/user/api-key/status`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Failed to check API key status");return a.json()}async function je(t,a){const s=await fetch(`${G}/api/user/api-key`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({apiKey:a})});if(!s.ok){const p=await s.json();throw new Error(p.error||"Failed to save API key")}}function ke(){const{user:t,isAdmin:a}=H(),[s,p]=d.useState(""),[r,g]=d.useState(!1),[m,y]=d.useState(!1),[x,u]=d.useState(!1),[h,l]=d.useState(null);d.useEffect(()=>{t&&!a?c():a&&g(!0)},[t,a]);const c=async()=>{if(t){y(!0);try{const o=localStorage.getItem("auth_token");if(!o)return;const w=await we(o);g(w.hasApiKey)}catch(o){console.error("Failed to load API key status:",o)}finally{y(!1)}}},i=async()=>{if(!(!t||!s.trim())){u(!0),l(null);try{const o=localStorage.getItem("auth_token");if(!o)throw new Error("Not authenticated");await je(o,s.trim()),l({type:"success",text:"API key saved securely!"}),p(""),g(!0)}catch(o){l({type:"error",text:o instanceof Error?o.message:"Failed to save API key"})}finally{u(!1)}}};return t?a?e.jsx("div",{className:"api-key-settings",children:e.jsxs("div",{className:"api-key-info admin",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"api-key-title",children:"Admin Account"}),e.jsx("p",{className:"api-key-description",children:"You're using the admin API key. No configuration needed."})]})]})}):m?e.jsx("div",{className:"api-key-settings",children:e.jsx("p",{className:"api-key-message",children:"Loading..."})}):e.jsxs("div",{className:"api-key-settings",children:[e.jsxs("div",{className:"api-key-header",children:[e.jsx("h3",{children:"OpenRouter API Key"}),r&&e.jsx("span",{className:"api-key-status-badge",children:"Configured"})]}),e.jsx("p",{className:"api-key-description",children:r?"Your API key is securely stored and encrypted. You can update it below.":"Enter your OpenRouter API key to use the chat feature. Your key will be encrypted and stored securely."}),e.jsxs("div",{className:"api-key-input-group",children:[e.jsx("input",{type:"password",value:s,onChange:o=>p(o.target.value),placeholder:"sk-or-v1-...",className:"api-key-input",disabled:x}),e.jsx("button",{onClick:i,disabled:!s.trim()||x,className:"api-key-save-button",children:x?"Saving...":r?"Update":"Save"})]}),h&&e.jsx("div",{className:`api-key-message ${h.type}`,children:h.text}),e.jsxs("div",{className:"api-key-help",children:[e.jsx("p",{children:e.jsx("strong",{children:"Don't have an API key?"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",children:"OpenRouter"})]}),e.jsx("li",{children:"Sign up or log in"}),e.jsx("li",{children:"Create a new API key"}),e.jsx("li",{children:"Copy and paste it here"})]}),e.jsx("p",{className:"api-key-security-note",children:"ðŸ”’ Your API key is encrypted with AES-256 and stored securely. Only you can use it."})]})]}):e.jsx("div",{className:"api-key-settings",children:e.jsx("p",{className:"api-key-message",children:"Please sign in to configure your API key."})})}function ve(){const{theme:t,toggleTheme:a}=Q(),[s,p]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"navbar",children:e.jsxs("div",{className:"navbar-content",children:[e.jsx("h1",{className:"navbar-title",children:"ChatNote"}),e.jsxs("div",{className:"navbar-actions",children:[e.jsx(ye,{}),e.jsx("button",{className:"settings-toggle",onClick:()=>p(!s),title:"Settings","aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"})]})}),e.jsx("button",{className:"theme-toggle",onClick:a,title:`Switch to ${t==="light"?"dark":"light"} mode`,"aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})]})]})}),s&&e.jsx("div",{className:"settings-modal-overlay",onClick:()=>p(!1),children:e.jsxs("div",{className:"settings-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"settings-modal-header",children:[e.jsx("h2",{children:"Settings"}),e.jsx("button",{className:"settings-modal-close",onClick:()=>p(!1),"aria-label":"Close settings",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"settings-modal-content",children:e.jsx(ke,{})})]})})]})}function te(){return localStorage.getItem("auth_token")}async function be(t,a,s,p){const r=te();if(!r)throw new Error("Authentication required. Please log in.");try{const g={messages:t,context:a,model:p||"openai/gpt-oss-120b",temperature:.7,maxTokens:3e3,stream:!!s},m=await fetch(`${G}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(g)});if(!m.ok){const x=await m.json().catch(()=>({error:{message:"Unknown error"}}));throw m.status===401?(localStorage.removeItem("auth_token"),new Error("Session expired. Please log in again.")):m.status===400&&x.error?.includes("API key not configured")?new Error("API key not configured. Please add your OpenRouter API key in settings."):new Error(x.error?.message||`API request failed with status ${m.status}`)}if(s&&m.body){const x=m.body.getReader(),u=new TextDecoder;let h="",l="";for(;;){const{done:c,value:i}=await x.read();if(c)break;l+=u.decode(i,{stream:!0});const o=l.split(`
`);l=o.pop()||"";for(const w of o){const v=w.trim();if(v&&v.startsWith("data: ")){const E=v.slice(6);if(E==="[DONE]")continue;try{const O=JSON.parse(E).choices?.[0]?.delta?.content||"";O&&(h+=O,s(O))}catch(A){console.warn("Failed to parse streaming chunk:",A)}}}}if(l.trim()){const c=l.trim();if(c.startsWith("data: ")){const i=c.slice(6);if(i!=="[DONE]")try{const w=JSON.parse(i).choices?.[0]?.delta?.content||"";w&&(h+=w,s(w))}catch{}}}return h}return(await m.json()).choices[0]?.message?.content||"No response from API"}catch(g){throw console.error("Chat service error:",g),g}}async function Se(){const t=te();if(!t)return!1;try{const a=await fetch(`${G}/api/user/api-key/status`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){const s=await a.json();return s.hasApiKey||s.isAdmin}return!1}catch{return!1}}function Ne(t){const a=/\[\s*\n*\s*((?:[^[\]]*\\[a-zA-Z@]+[^[\]]*)+)\s*\n*\s*\]/g;return t.replace(a,(s,p)=>/\\[a-zA-Z@]+/.test(p)?`\\[${p.trim().replace(/\n\s*\n+/g,`
`).replace(/^\s+|\s+$/gm,"")}\\]`:s)}function Ee({selectedText:t,onToggleLayout:a,layout:s}){const{theme:p}=Q(),{isAuthenticated:r,user:g}=H(),[m,y]=d.useState([]),[x,u]=d.useState(""),[h,l]=d.useState(!1),[c,i]=d.useState(null),[o,w]=d.useState(!0),[v,E]=d.useState(!0),[A,O]=d.useState(fe),[S,M]=d.useState(!1),k=d.useRef(null),L=d.useRef(null),I=d.useRef(null),j=d.useRef(null),C=d.useRef(null),[R,B]=d.useState(null),U=()=>{k.current?.scrollIntoView({behavior:"smooth"})},F=()=>{const n=L.current;if(n){n.style.height="auto";const N=Math.min(Math.max(n.scrollHeight,24),200);n.style.height=`${N}px`}};d.useEffect(()=>{U()},[m]),d.useEffect(()=>{L.current?.focus(),F()},[]),d.useEffect(()=>{const n=setTimeout(()=>{F()},0);return()=>clearTimeout(n)},[x]),d.useEffect(()=>{(async()=>{if(r){const f=await Se();w(!f)}else w(!0)})()},[r,g]),d.useEffect(()=>{s==="split"&&E(!1)},[s]),d.useEffect(()=>{if(!S){B(null);return}const n=()=>{if(j.current){const _=j.current.getBoundingClientRect(),P=Math.max(_.width,220);B({width:P})}};n();const f=setTimeout(n,10),b=requestAnimationFrame(n),N=setTimeout(n,50);return window.addEventListener("scroll",n,!0),window.addEventListener("resize",n),()=>{clearTimeout(f),clearTimeout(N),cancelAnimationFrame(b),window.removeEventListener("scroll",n,!0),window.removeEventListener("resize",n)}},[S]),d.useEffect(()=>{if(!S)return;const n=b=>{const N=b.target;j.current&&C.current&&!j.current.contains(N)&&!C.current.contains(N)&&M(!1)},f=setTimeout(()=>{document.addEventListener("mousedown",n)},100);return()=>{clearTimeout(f),document.removeEventListener("mousedown",n)}},[S]);const K=n=>{O(n),M(!1)},q=()=>{if(o)return"Select Model";const n=D.find(f=>f.id===A);return n?n.name:"Select Model"},V=async()=>{const n=x.trim();if(!n&&!t)return;if(!r){i("Please sign in to use the chat feature.");return}if(o){i("Please configure your OpenRouter API key in Settings.");return}v&&E(!1),I.current&&I.current.abort(),I.current=new AbortController;let f=n;t&&!n?f=`Tell me about this: ${t}`:t&&n&&(f=`${n}

Context from PDF: ${t}`);const b={id:Date.now().toString(),role:"user",content:f};y(P=>[...P,b]),u(""),setTimeout(()=>{F()},0),l(!0),i(null);const N=(Date.now()+1).toString(),_={id:N,role:"assistant",content:""};y(P=>[...P,_]);try{const P=m.slice(-10).map(T=>({role:T.role,content:T.content}));let $="";await be([...P,b],t&&!n?t:void 0,T=>{$+=T,y(se=>se.map(W=>W.id===N?{...W,content:$}:W)),U()},A)}catch(P){console.error("Error sending message:",P),i(P instanceof Error?P.message:"Failed to send message"),y($=>$.filter(T=>T.id!==N))}finally{l(!1),I.current=null,L.current?.focus()}},ne=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),V())},oe=()=>{t&&(u(`Tell me about this: ${t}`),L.current?.focus())},Z=()=>{y([]),i(null)};return e.jsxs("div",{className:"chatgpt-wrapper",children:[!r&&s==="floating"&&e.jsxs("div",{className:"api-key-warning-outer",children:[e.jsx("span",{children:"ðŸ” Please sign in to use the chat feature"}),e.jsx("span",{className:"warning-hint",children:'Click "Sign in with Google" in the navigation bar'})]}),r&&o&&s==="floating"&&e.jsxs("div",{className:"api-key-warning-outer",children:[e.jsx("span",{children:"âš ï¸ OpenRouter API key not configured"}),e.jsx("span",{className:"warning-hint",children:g?.role==="admin"?"Admin API key not configured on server":"Add your API key in Settings (click the gear icon)"})]}),s==="floating"&&e.jsxs("div",{className:`model-selector-bar ${p==="dark"?"theme-dark":"theme-light"}`,children:[e.jsxs("div",{className:"model-selector-wrapper",ref:j,children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const f=!S;M(f),f||B(null)},className:"model-selector-button",title:"Select AI model",disabled:o,children:[e.jsx("span",{className:"model-selector-text",children:q()}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:S?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]}),S&&e.jsx("div",{ref:C,className:"model-selector-dropdown",onClick:n=>n.stopPropagation(),onMouseDown:n=>n.stopPropagation(),style:R?{width:`${R.width}px`}:void 0,children:D.map(n=>e.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),K(n.id)},className:`model-option ${A===n.id?"selected":""}`,children:[e.jsxs("div",{className:"model-option-content",children:[e.jsx("span",{className:"model-option-name",children:n.name}),e.jsx("span",{className:"model-option-provider",children:n.provider})]}),A===n.id&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]},n.id))})]}),e.jsxs("div",{className:"header-actions",children:[m.length>0&&e.jsx("button",{onClick:Z,className:"clear-button",title:"Clear chat",children:"Clear"}),s==="floating"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a,className:"layout-toggle-button",title:s==="floating"?"Switch to split layout":"Switch to floating layout","aria-label":s==="floating"?"Switch to split layout":"Switch to floating layout",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s==="floating"?e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("line",{x1:"10",y1:"3",x2:"10",y2:"10"}),e.jsx("line",{x1:"3",y1:"10",x2:"10",y2:"10"})]}):e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]})})}),e.jsx("button",{onClick:()=>E(!v),className:"collapse-button",title:v?"Expand chat":"Collapse chat","aria-label":v?"Expand chat":"Collapse chat",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:v?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M18 15l-6-6-6 6"})})})]})]})]}),e.jsxs("div",{className:`chatgpt-inner ${p==="dark"?"theme-dark":"theme-light"} ${v&&s==="floating"?"collapsed":""}`,children:[t&&e.jsxs("div",{className:"selected-text-banner",children:[e.jsx("span",{className:"banner-text",children:"Selected text available"}),e.jsx("button",{onClick:oe,className:"use-text-button",children:"Use in chat"})]}),(!v||s==="split")&&e.jsxs("div",{className:"chatgpt-messages",children:[m.length===0&&e.jsxs("div",{className:"welcome-screen",children:[e.jsx("div",{className:"welcome-icon",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"#10a37f",opacity:"0.1"}),e.jsx("path",{d:"M6 9H18M6 13H14",stroke:"#10a37f",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("h3",{children:"How can I help you today?"}),e.jsx("p",{children:"Ask me anything about your PDF, or select text to get context-specific answers."})]}),m.map(n=>e.jsxs("div",{className:`message ${n.role==="user"?"message-user":"message-assistant"}`,children:[e.jsx("div",{className:"message-avatar",children:n.role==="user"?e.jsx("div",{className:"avatar-user",children:"U"}):e.jsx("div",{className:"avatar-assistant",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"currentColor"})})})}),e.jsx("div",{className:"message-content-wrapper",children:e.jsx("div",{className:"message-content",children:n.role==="assistant"&&h&&!n.content?e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):n.role==="assistant"&&n.content?e.jsx("div",{className:"markdown-content",children:e.jsx(re,{remarkPlugins:[de,ue],rehypePlugins:[ce],components:{table:({children:f,...b})=>e.jsx("div",{className:"table-scroll-wrapper",children:e.jsx("table",{...b,children:f})}),div:({children:f,className:b,...N})=>b&&(b.includes("katex-display")||b.includes("math-display"))?e.jsx("div",{className:`math-scroll-wrapper ${b}`,...N,children:f}):e.jsx("div",{...N,className:b,children:f}),pre:({children:f,...b})=>e.jsx("pre",{className:"code-scroll-wrapper",...b,children:f})},children:Ne(n.content)})}):e.jsx("div",{className:"markdown-content",children:n.content})})})]},n.id)),c&&e.jsxs("div",{className:"error-message",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("div",{className:"error-text",children:c})]}),e.jsx("div",{ref:k})]}),!r&&s==="split"&&e.jsxs("div",{className:"api-key-warning-split-top",children:[e.jsx("span",{children:"ðŸ” Please sign in to use the chat feature"}),e.jsx("span",{className:"warning-hint",children:'Click "Sign in with Google" in the navigation bar'})]}),r&&o&&s==="split"&&e.jsxs("div",{className:"api-key-warning-split-top",children:[e.jsx("span",{children:"âš ï¸ OpenRouter API key not configured"}),e.jsx("span",{className:"warning-hint",children:g?.role==="admin"?"Admin API key not configured on server":"Add your API key in Settings (click the gear icon)"})]}),s==="split"&&e.jsxs("div",{className:`model-selector-bar ${p==="dark"?"theme-dark":"theme-light"}`,children:[e.jsxs("div",{className:"model-selector-wrapper",ref:j,children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const f=!S;M(f),f||B(null)},className:"model-selector-button",title:"Select AI model",disabled:o||!r,children:[e.jsx("span",{className:"model-selector-text",children:q()}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:S?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]}),S&&e.jsx("div",{ref:C,className:"model-selector-dropdown",onClick:n=>n.stopPropagation(),onMouseDown:n=>n.stopPropagation(),style:R?{width:`${R.width}px`}:void 0,children:D.map(n=>e.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),K(n.id)},className:`model-option ${A===n.id?"selected":""}`,children:[e.jsxs("div",{className:"model-option-content",children:[e.jsx("span",{className:"model-option-name",children:n.name}),e.jsx("span",{className:"model-option-provider",children:n.provider})]}),A===n.id&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]},n.id))})]}),m.length>0&&e.jsx("button",{onClick:Z,className:"clear-button",title:"Clear chat",children:"Clear"}),e.jsx("button",{onClick:a,className:"layout-toggle-button",title:"Switch to floating layout","aria-label":"Switch to floating layout",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("line",{x1:"10",y1:"3",x2:"10",y2:"10"}),e.jsx("line",{x1:"3",y1:"10",x2:"10",y2:"10"})]})})]}),e.jsx("div",{className:"chatgpt-input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx("textarea",{ref:L,value:x,onChange:n=>u(n.target.value),onKeyPress:ne,placeholder:"Ask a question...",rows:1,className:"chatgpt-input",disabled:h||o||!r}),e.jsx("button",{onClick:V,disabled:!x.trim()&&!t||h||o||!r,className:"send-button",title:"Send message",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})]}),s==="floating"&&e.jsx("div",{className:`footer-text-outer ${p==="dark"?"theme-dark":"theme-light"}`,children:e.jsx("span",{className:"footer-text",children:"AI responses may contain errors. Please verify important information."})})]})}class Ce extends d.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#666",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{maxWidth:"400px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"PDF Viewer Temporarily Unavailable"}),e.jsx("p",{style:{marginBottom:"20px"},children:"There's a configuration issue with the PDF viewer. The rest of the app is working fine!"}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",marginBottom:"20px"},children:["Error: ",this.state.error?.message||"Unknown error"]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("label",{htmlFor:"pdf-upload-fallback",style:{padding:"12px 24px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:"pointer",display:"inline-block"},children:"Upload PDF (Basic)"}),e.jsx("input",{id:"pdf-upload-fallback",type:"file",accept:"application/pdf",onChange:a=>{const s=a.target.files?.[0];s&&alert(`PDF "${s.name}" selected. PDF viewing will work once the configuration issue is resolved.`)},style:{display:"none"}})]}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Try Again"})]})}):this.props.children}}const Ae=d.lazy(()=>ge(()=>import("./PDFViewer-BpxVOLHw.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Pe(){const[t,a]=d.useState(null),[s,p]=d.useState(""),[r,g]=d.useState("floating"),m=u=>{a(u)},y=u=>{p(u)},x=()=>{g(u=>u==="floating"?"split":"floating")};return e.jsx(me,{children:e.jsx(xe,{children:e.jsxs("div",{className:"app",children:[e.jsx(ve,{}),e.jsxs("div",{className:`main-content ${r==="split"?"split-layout":""}`,children:[e.jsx(Ce,{children:e.jsx(d.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading PDF viewer..."}),children:e.jsx(Ae,{file:t,onFileUpload:m,onTextSelection:y,layout:r})})}),e.jsx("div",{className:`chat-container ${r==="floating"?"floating-chat":"split-chat"}`,children:e.jsx(Ee,{selectedText:s,onToggleLayout:x,layout:r})})]})]})})})}const z=document.getElementById("root");if(!z)throw new Error("Root element not found");try{ie.createRoot(z).render(e.jsx(ae.StrictMode,{children:e.jsx(Pe,{})}))}catch(t){z.innerHTML=`
    <div style="padding: 20px; color: red;">
      <h1>Error Loading App</h1>
      <p>${t instanceof Error?t.message:String(t)}</p>
      <p>Check the browser console for more details.</p>
    </div>
  `}
