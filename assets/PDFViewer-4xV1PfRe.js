import{r as s,j as o,D as ie,P as le}from"./vendor-react-BecnK9Vx.js";import{G as B}from"./vendor-pdf-DDxsMbbh.js";import"./vendor-DuqZcPz3.js";function fe({file:w,onFileUpload:A,onTextSelection:x,layout:Z="floating"}){const[u,O]=s.useState(0),[h,P]=s.useState(1),[c,f]=s.useState(1),[v,m]=s.useState(!1),[R,i]=s.useState("100"),k=s.useRef(null),g=s.useRef(new Map),N=s.useRef(null),S=s.useRef(null),I=s.useRef(!1),d=s.useRef(new Map),C=s.useMemo(()=>w?URL.createObjectURL(w):null,[w]);s.useEffect(()=>()=>{C&&URL.revokeObjectURL(C)},[C]);const H=s.useMemo(()=>{let e;{const t="/ChatNote/";e=`${t.endsWith("/")?t:`${t}/`}pdf.worker.min.js`}return B&&(B.workerSrc=e),{workerSrc:e,cMapUrl:"https://unpkg.com/pdfjs-dist@5.4.394/cmaps/",cMapPacked:!0,standardFontDataUrl:"https://unpkg.com/pdfjs-dist@5.4.394/standard_fonts/"}},[]),K=({numPages:e})=>{O(e),P(1),g.current.clear(),d.current.clear()},$=e=>{if(!d.current.has(e.pageNumber))try{const t=e.page;let n,r;t.viewport?(n=t.viewport.width,r=t.viewport.height):(n=t.width/c,r=t.height/c),d.current.set(e.pageNumber,{width:n,height:r})}catch(t){console.warn("Error getting page dimensions:",t);const n=e.page;d.current.set(e.pageNumber,{width:n.width/c,height:n.height/c})}};s.useEffect(()=>{if(!N.current||u===0)return;let e=null,t=!1;const n=()=>{if(I.current||t||e)return;t=!0,e=setTimeout(()=>{e=null,t=!1},100);const a=N.current;if(!a){t=!1;return}const b=a.getBoundingClientRect(),D=b.top,E=b.height,ce=D+E/2;if(a.scrollTop<100){P(l=>l!==1?1:l);return}let L=1,T=0;for(let l=1;l<=u;l++){const M=g.current.get(l);if(M){const p=M.getBoundingClientRect(),j=a.getBoundingClientRect(),F=Math.max(j.top,p.top),V=Math.min(j.bottom,p.bottom),y=Math.max(0,V-F);y>T&&(T=y,L=l)}}if(T<E*.1){let l=1,M=1/0;for(let p=1;p<=u;p++){const j=g.current.get(p);if(j){const F=j.getBoundingClientRect(),V=F.top+F.height/2,y=Math.abs(V-ce);y<M&&(M=y,l=p)}}L=l}P(l=>L!==l?L:l)},r=N.current;return r?.addEventListener("scroll",n,{passive:!0}),()=>{e&&clearTimeout(e),r?.removeEventListener("scroll",n)}},[u]);const _=e=>{console.error("PDF load error:",e)},G=e=>{const t=e.target.files?.[0];t&&t.type==="application/pdf"&&A(t)},z=s.useCallback(e=>{const t=g.current.get(e);t&&N.current&&(I.current=!0,P(e),t.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{I.current=!1},1500))},[]),q=()=>{const e=Math.max(1,h-1);z(e)},J=()=>{const e=Math.min(u,h+1);z(e)},Q=()=>{const e=Math.min(c+.2,5);f(e),i(Math.round(e*100).toString())},X=()=>{const e=Math.max(c-.2,.25);f(e),i(Math.round(e*100).toString())};s.useEffect(()=>{v||i(Math.round(c*100).toString())},[c,v]);const Y=()=>{m(!0),i(Math.round(c*100).toString())},ee=e=>{let t=e.target.value;t=t.replace(/[^0-9]/g,""),t.length>1&&t.startsWith("0")&&(t=t.replace(/^0+/,"")||"0"),t.length>3&&(t=t.slice(0,3)),i(t)},te=()=>{U()},ne=e=>{if(e.key==="Enter")e.preventDefault(),U();else if(e.key==="Escape")m(!1),i(Math.round(c*100).toString()),k.current?.blur();else{if(e.key==="Backspace"||e.key==="Delete"||e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="Tab")return;(e.key==="-"||e.key==="+"||e.key==="."||e.key===","||e.key==="e"||e.key==="E"||!/[0-9]/.test(e.key)&&!e.ctrlKey&&!e.metaKey)&&e.preventDefault()}},oe=e=>{e.preventDefault();const n=e.clipboardData.getData("text").replace(/[^0-9]/g,"");if(n){const a=(n.replace(/^0+/,"")||"0").slice(0,3);if(i(a),a&&a!=="0"){const b=parseInt(a,10);if(!isNaN(b)&&b>0){const D=Math.max(25,Math.min(500,b)),E=D/100;f(E),i(D.toString()),m(!1)}}}},U=()=>{if(R.trim()===""||R==="0"){i(Math.round(c*100).toString()),m(!1);return}const e=parseInt(R,10);if(isNaN(e)||e<=0){i(Math.round(c*100).toString()),m(!1);return}const t=Math.max(25,Math.min(500,e)),n=t/100;f(n),i(t.toString()),m(!1)};s.useEffect(()=>{v&&k.current&&(k.current.focus(),k.current.select())},[v]);const se=()=>{if(!S.current||d.current.size===0)return;const e=S.current.getBoundingClientRect();let t;Z==="split"?t=e.width-40:t=window.innerWidth-40;const n=d.current.get(1);if(!n)return;const r=t/n.width,a=Math.max(.1,Math.min(r,5));f(a),i(Math.round(a*100).toString())},re=()=>{if(!S.current||d.current.size===0)return;const t=S.current.getBoundingClientRect().height-100,n=d.current.get(h);if(!n)return;const r=t/n.height,a=Math.max(.1,Math.min(r,5));f(a),i(Math.round(a*100).toString())},W=s.useCallback(()=>{const e=window.getSelection();if(e&&e.toString().trim()){const t=e.toString().trim();x(t)}else x("")},[x]),ae=s.useCallback(()=>{setTimeout(()=>{const e=window.getSelection();(!e||!e.toString().trim())&&x("")},10)},[x]);return w?o.jsxs("div",{className:"pdf-viewer",ref:S,children:[o.jsx("div",{className:"pdf-controls-top",children:o.jsxs("div",{className:"zoom-controls",children:[o.jsx("button",{onClick:se,className:"control-button fit-button",title:"Fit to width",children:"↔"}),o.jsx("button",{onClick:re,className:"control-button fit-button",title:"Fit to height",children:"↕"}),o.jsx("button",{onClick:X,className:"control-button",children:"−"}),v?o.jsx("input",{ref:k,type:"text",inputMode:"numeric",pattern:"[0-9]*",value:R,onChange:ee,onBlur:te,onKeyDown:ne,onPaste:oe,className:"zoom-input"}):o.jsxs("span",{className:"zoom-level",onClick:Y,title:"Click to edit zoom level",children:[Math.round(c*100),"%"]}),o.jsx("button",{onClick:Q,className:"control-button",children:"+"})]})}),o.jsx("div",{ref:N,className:"pdf-content",onMouseUp:W,onKeyUp:W,onClick:ae,children:o.jsx(ie,{file:C||w,onLoadSuccess:K,onLoadError:_,loading:o.jsx("div",{className:"loading",children:"Loading PDF..."}),error:o.jsxs("div",{className:"error",children:["Failed to load PDF. Please check the console for details.",o.jsx("br",{}),o.jsxs("small",{children:["Worker: ",B?.workerSrc||"Not set"]})]}),noData:o.jsx("div",{className:"loading",children:"No PDF file selected"}),options:H,children:Array.from(new Array(u),(e,t)=>{const n=t+1;return o.jsx("div",{ref:r=>{r?g.current.set(n,r):g.current.delete(n)},className:"pdf-page-wrapper",children:o.jsx(le,{pageNumber:n,scale:c,renderTextLayer:!0,renderAnnotationLayer:!0,onLoadSuccess:r=>$({pageNumber:n,page:r})},`page_${n}`)},`page-wrapper-${n}`)})})}),o.jsxs("div",{className:"pdf-controls-bottom",children:[o.jsx("button",{onClick:q,disabled:h<=1,className:"nav-button",children:"Previous"}),o.jsxs("span",{className:"page-info",children:["Page ",h," of ",u]}),o.jsx("button",{onClick:J,disabled:h>=u,className:"nav-button",children:"Next"})]})]}):o.jsx("div",{className:`pdf-viewer-empty ${Z==="floating"?"float-layout":""}`,children:o.jsxs("div",{className:"upload-container",children:[o.jsx("label",{htmlFor:"pdf-upload",className:"upload-button",children:"Upload PDF"}),o.jsx("input",{id:"pdf-upload",type:"file",accept:"application/pdf",onChange:G,style:{display:"none"}})]})})}export{fe as default};
