const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PDFViewer-BpxVOLHw.js","assets/vendor-react-BecnK9Vx.js","assets/vendor-DuqZcPz3.js","assets/vendor-C5EChc_d.css","assets/vendor-pdf-DDxsMbbh.js","assets/vendor-react-CBXYWCWZ.css","assets/PDFViewer-BGNy3bfx.css"])))=>i.map(i=>d[i]);
import{r as a,j as e,M as re,R as ie,a as ae}from"./vendor-react-BecnK9Vx.js";import{p as le}from"./vendor-pdf-DDxsMbbh.js";import{k as ce,l as de,n as ue}from"./vendor-DuqZcPz3.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&c(h)}).observe(document,{childList:!0,subtree:!0});function s(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(o){if(o.ep)return;o.ep=!0;const d=s(o);fetch(o.href,d)}})();if(typeof window<"u"){let t;{const c="/ChatNote/";t=`${c.endsWith("/")?c:`${c}/`}pdf.worker.min.js`}const i=c=>{try{if(c)if(!c.GlobalWorkerOptions)c.GlobalWorkerOptions={workerSrc:t};else try{c.GlobalWorkerOptions.workerSrc=t}catch{try{Object.defineProperty(c,"GlobalWorkerOptions",{value:{workerSrc:t},writable:!0,configurable:!0})}catch{}}}catch{}};window.pdfjsLib||(window.pdfjsLib={}),window.pdfjsLib.GlobalWorkerOptions?window.pdfjsLib.GlobalWorkerOptions.workerSrc=t:window.pdfjsLib.GlobalWorkerOptions={workerSrc:t},typeof window.pdfjs>"u"&&(window.pdfjs={}),window.pdfjs.GlobalWorkerOptions?window.pdfjs.GlobalWorkerOptions.workerSrc=t:window.pdfjs.GlobalWorkerOptions={workerSrc:t};const s=le;if(i(s),s.default&&i(s.default),s.GlobalWorkerOptions)try{s.GlobalWorkerOptions.workerSrc=t}catch{}}const he="modulepreload",pe=function(t){return"/ChatNote/"+t},J={},ge=function(i,s,c){let o=Promise.resolve();if(s&&s.length>0){let x=function(l){return Promise.all(l.map(p=>Promise.resolve(p).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),w=h?.nonce||h?.getAttribute("nonce");o=x(s.map(l=>{if(l=pe(l),l in J)return;J[l]=!0;const p=l.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":he,p||(m.as="script"),m.crossOrigin="",m.href=l,w&&m.setAttribute("nonce",w),document.head.appendChild(m),p)return new Promise((g,r)=>{m.addEventListener("load",g),m.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${l}`)))})}))}function d(h){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=h,window.dispatchEvent(w),!w.defaultPrevented)throw h}return o.then(h=>{for(const w of h||[])w.status==="rejected"&&d(w.reason);return i().catch(d)})},Y=a.createContext(void 0);function me({children:t}){const[i,s]=a.useState(()=>localStorage.getItem("theme")||"light");a.useEffect(()=>{document.documentElement.setAttribute("data-theme",i),localStorage.setItem("theme",i)},[i]);const c=()=>{s(o=>o==="light"?"dark":"light")};return e.jsx(Y.Provider,{value:{theme:i,toggleTheme:c},children:t})}function Q(){const t=a.useContext(Y);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const D=[{id:"openai/gpt-oss-120b",name:"GPT OSS",provider:"OpenAI"},{id:"tngtech/deepseek-r1t2-chimera:free",name:"DeepSeek R1",provider:"DeepSeek"},{id:"deepseek/deepseek-chat-v3.1:free",name:"DeepSeek V3.1",provider:"DeepSeek"},{id:"meta-llama/llama-3.3-70b-instruct:free",name:"Llama 3.3",provider:"Meta"},{id:"qwen/qwen3-235b-a22b:free",name:"Qwen 3",provider:"Qwen"}],fe=D[0].id,I="http://localhost:3000",X="05659660993-u7lnrcbis23u3mlaigteag67d6h6inar.apps.googleusercontent.com",ee=a.createContext(void 0);function xe({children:t}){const[i,s]=a.useState(null),[c,o]=a.useState(!0);a.useEffect(()=>{const x=localStorage.getItem("auth_token");x?d(x):o(!1)},[]);const d=async(x,l=0)=>{let u=!1;try{const m=new AbortController,g=setTimeout(()=>m.abort(),1e4),r=await fetch(`${I}/api/auth/me`,{headers:{Authorization:`Bearer ${x}`},signal:m.signal});if(clearTimeout(g),r.ok){const y=await r.json();s(y.user),u=!0}else if(r.status===401||r.status===403)console.warn("Token invalid, logging out"),localStorage.removeItem("auth_token"),s(null),u=!0;else{if(l<2)return console.warn(`Failed to fetch user (${r.status}), retrying... (${l+1}/2)`),await new Promise(y=>setTimeout(y,1e3*(l+1))),d(x,l+1);console.error("Failed to fetch user after retries, but keeping token:",r.status),u=!0}}catch(m){if(l<2){const g=m instanceof Error?m.name:"Unknown";return console.warn(`Network error (${g}), retrying... (${l+1}/2)`),await new Promise(r=>setTimeout(r,1e3*(l+1))),d(x,l+1)}else m instanceof Error&&m.name==="AbortError"?console.warn("Request timeout after retries, but keeping user logged in"):console.error("Network error fetching user after retries, but keeping token:",m),u=!0}finally{u&&o(!1)}},h=async x=>{try{const l=await fetch(`${I}/api/auth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:x})});if(!l.ok){const u=await l.json();throw new Error(u.error||"Authentication failed")}const p=await l.json();localStorage.setItem("auth_token",p.token),s(p.user)}catch(l){throw console.error("Login error:",l),l}},w=()=>{localStorage.removeItem("auth_token"),s(null)};return e.jsx(ee.Provider,{value:{user:i,loading:c,login:h,logout:w,isAuthenticated:!!i,isAdmin:i?.role==="admin"},children:t})}function H(){const t=a.useContext(ee);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function we(){const{user:t,login:i,logout:s,loading:c}=H(),[o,d]=a.useState(!1),[h,w]=a.useState(null),x=a.useCallback(async p=>{try{await i(p.credential);const u=document.getElementById("google-signin-button");u&&u.remove()}catch(u){console.error("Login failed:",u),alert(u instanceof Error?u.message:"Login failed. Please try again.")}},[i]);a.useEffect(()=>{if(window.google){try{window.google.accounts.id.initialize({client_id:X,callback:x}),d(!0)}catch(m){console.error("Failed to initialize Google OAuth:",m),w("Failed to initialize Google OAuth")}return}const p=document.createElement("script");p.src="https://accounts.google.com/gsi/client",p.async=!0,p.defer=!0,p.onload=()=>{if(window.google)try{window.google.accounts.id.initialize({client_id:X,callback:x,use_fedcm_for_prompt:!0}),d(!0)}catch(m){console.error("Failed to initialize Google OAuth:",m),w("Failed to initialize Google OAuth")}else console.error("Google script loaded but window.google is not available"),w("Google script failed to load")},p.onerror=()=>{console.error("Failed to load Google Identity Services script"),w("Failed to load Google Sign-In script"),d(!1)};const u=setTimeout(()=>{window.google||(console.error("Google script loading timeout"),w("Google Sign-In is taking too long to load"),d(!1))},1e4);return document.head.appendChild(p),()=>{clearTimeout(u)}},[x]),a.useEffect(()=>{if(t){const p=document.getElementById("google-signin-button");p&&p.remove()}},[t]);const l=()=>{if(h){alert(`Google Sign-In error: ${h}. Please check the browser console.`);return}if(window.google&&o)try{const p=console.error,u=console.warn;console.error=(...g)=>{const r=g.join(" ");r.includes("AbortError")||r.includes("signal is aborted")||r.includes("FedCM get() rejects")||r.includes("The request has been aborted")||r.includes("403")||r.includes("credential_button_library")||r.includes("The given origin is not allowed")||r.includes("GSI_LOGGER")||typeof g[0]=="string"&&g[0].includes("403")||p.apply(console,g)},console.warn=(...g)=>{const r=g.join(" ");r.includes("Cross-Origin-Opener-Policy")||r.includes("window.postMessage")||r.includes("GSI_LOGGER")||u.apply(console,g)};const m=window.onerror;window.onerror=(g,r,y,v,C)=>typeof g=="string"&&(g.includes("403")||g.includes("credential_button_library")||g.includes("accounts.google.com")||r?.includes("accounts.google.com"))?!0:m?m(g,r,y,v,C):!1,setTimeout(()=>{console.error=p,console.warn=u,window.onerror=m},5e3),window.google.accounts.id.prompt(g=>{const r=g.getNotDisplayedReason?.(),y=g.getSkippedReason?.(),v=g.getDismissedReason?.(),C=g.isNotDisplayed?.(),N=g.isSkippedMoment?.(),A=g.isDismissedMoment?.();if(r||y||v||C||N||A){const b=document.getElementById("google-signin-button");b&&b.remove();const j=document.createElement("div");j.id="google-signin-button",j.style.position="fixed",j.style.top="50%",j.style.left="50%",j.style.transform="translate(-50%, -50%)",j.style.zIndex="10000",j.style.background="white",j.style.padding="20px",j.style.borderRadius="8px",j.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)",document.body.appendChild(j);try{window.google.accounts.id.renderButton(j,{theme:"outline",size:"large",text:"signin_with",width:250})}catch(O){console.warn("Could not render Google button, showing manual login option:",O),j.innerHTML=`
                <p style="margin: 0 0 10px 0; text-align: center;">Sign in with Google</p>
                <button onclick="window.location.href='https://accounts.google.com/signin'" 
                        style="padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                  Continue with Google
                </button>
                <button onclick="document.getElementById('google-signin-button').remove()" 
                        style="margin-top: 10px; padding: 5px 10px; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                  Cancel
                </button>
              `}}})}catch(p){console.error("Error showing Google sign-in:",p);try{window.google.accounts.id.prompt()}catch(u){console.error("Fallback prompt also failed:",u),alert("Failed to show Google Sign-In. Please try refreshing the page.")}}else alert("Google Sign-In is still loading. Please wait a moment and try again.")};return c&&!t?e.jsx("div",{className:"login-button loading",children:e.jsx("span",{children:"Loading..."})}):t?e.jsxs("div",{className:"login-button user-info",children:[e.jsx("div",{className:"user-avatar",children:t.picture?e.jsx("img",{src:t.picture,alt:t.name||t.email}):e.jsx("span",{children:t.name?.[0]||t.email[0].toUpperCase()})}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:t.name||t.email}),t.role==="admin"&&e.jsx("span",{className:"user-role",children:"Admin"})]}),e.jsx("button",{onClick:s,className:"logout-button",title:"Logout",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})})]}):h&&!o?e.jsxs("button",{onClick:l,className:"login-button sign-in error",title:h,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),"Sign in (Error)"]}):e.jsx("button",{onClick:l,className:"login-button sign-in",disabled:!o&&!h,title:o?"Sign in with Google":"Loading Google Sign-In...",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"}),e.jsx("path",{d:"M3 20a6 6 0 0 1 6-6h6a6 6 0 0 1 6 6v1H3v-1Z"})]}),"Sign in with Google"]}):e.jsx("span",{children:"Loading Google Sign-In..."})})}async function ye(t){const i=await fetch(`${I}/api/user/api-key/status`,{headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error("Failed to check API key status");return i.json()}async function je(t,i){const s=await fetch(`${I}/api/user/api-key`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({apiKey:i})});if(!s.ok){const c=await s.json();throw new Error(c.error||"Failed to save API key")}}function ke(){const{user:t,isAdmin:i}=H(),[s,c]=a.useState(""),[o,d]=a.useState(!1),[h,w]=a.useState(!1),[x,l]=a.useState(!1),[p,u]=a.useState(null);a.useEffect(()=>{t&&!i?m():i&&d(!0)},[t,i]);const m=async()=>{if(t){w(!0);try{const r=localStorage.getItem("auth_token");if(!r)return;const y=await ye(r);d(y.hasApiKey)}catch(r){console.error("Failed to load API key status:",r)}finally{w(!1)}}},g=async()=>{if(!(!t||!s.trim())){l(!0),u(null);try{const r=localStorage.getItem("auth_token");if(!r)throw new Error("Not authenticated");await je(r,s.trim()),u({type:"success",text:"API key saved securely!"}),c(""),d(!0)}catch(r){u({type:"error",text:r instanceof Error?r.message:"Failed to save API key"})}finally{l(!1)}}};return t?i?e.jsx("div",{className:"api-key-settings",children:e.jsxs("div",{className:"api-key-info admin",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"api-key-title",children:"Admin Account"}),e.jsx("p",{className:"api-key-description",children:"You're using the admin API key. No configuration needed."})]})]})}):h?e.jsx("div",{className:"api-key-settings",children:e.jsx("p",{className:"api-key-message",children:"Loading..."})}):e.jsxs("div",{className:"api-key-settings",children:[e.jsxs("div",{className:"api-key-header",children:[e.jsx("h3",{children:"OpenRouter API Key"}),o&&e.jsx("span",{className:"api-key-status-badge",children:"Configured"})]}),e.jsx("p",{className:"api-key-description",children:o?"Your API key is securely stored and encrypted. You can update it below.":"Enter your OpenRouter API key to use the chat feature. Your key will be encrypted and stored securely."}),e.jsxs("div",{className:"api-key-input-group",children:[e.jsx("input",{type:"password",value:s,onChange:r=>c(r.target.value),placeholder:"sk-or-v1-...",className:"api-key-input",disabled:x}),e.jsx("button",{onClick:g,disabled:!s.trim()||x,className:"api-key-save-button",children:x?"Saving...":o?"Update":"Save"})]}),p&&e.jsx("div",{className:`api-key-message ${p.type}`,children:p.text}),e.jsxs("div",{className:"api-key-help",children:[e.jsx("p",{children:e.jsx("strong",{children:"Don't have an API key?"})}),e.jsxs("ol",{children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",children:"OpenRouter"})]}),e.jsx("li",{children:"Sign up or log in"}),e.jsx("li",{children:"Create a new API key"}),e.jsx("li",{children:"Copy and paste it here"})]}),e.jsx("p",{className:"api-key-security-note",children:"ðŸ”’ Your API key is encrypted with AES-256 and stored securely. Only you can use it."})]})]}):e.jsx("div",{className:"api-key-settings",children:e.jsx("p",{className:"api-key-message",children:"Please sign in to configure your API key."})})}function ve(){const{theme:t,toggleTheme:i}=Q(),[s,c]=a.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"navbar",children:e.jsxs("div",{className:"navbar-content",children:[e.jsx("h1",{className:"navbar-title",children:"ChatNote"}),e.jsxs("div",{className:"navbar-actions",children:[e.jsx(we,{}),e.jsx("button",{className:"settings-toggle",onClick:()=>c(!s),title:"Settings","aria-label":"Settings",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"})]})}),e.jsx("button",{className:"theme-toggle",onClick:i,title:`Switch to ${t==="light"?"dark":"light"} mode`,"aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})]})]})}),s&&e.jsx("div",{className:"settings-modal-overlay",onClick:()=>c(!1),children:e.jsxs("div",{className:"settings-modal",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"settings-modal-header",children:[e.jsx("h2",{children:"Settings"}),e.jsx("button",{className:"settings-modal-close",onClick:()=>c(!1),"aria-label":"Close settings",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:"settings-modal-content",children:e.jsx(ke,{})})]})})]})}function te(){return localStorage.getItem("auth_token")}async function be(t,i,s,c){const o=te();if(!o)throw new Error("Authentication required. Please log in.");try{const d={messages:t,context:i,model:c||"openai/gpt-oss-120b",temperature:.7,maxTokens:3e3,stream:!!s},h=await fetch(`${I}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(d)});if(!h.ok){const x=await h.json().catch(()=>({error:{message:"Unknown error"}}));throw h.status===401?(localStorage.removeItem("auth_token"),new Error("Session expired. Please log in again.")):h.status===400&&x.error?.includes("API key not configured")?new Error("API key not configured. Please add your OpenRouter API key in settings."):new Error(x.error?.message||`API request failed with status ${h.status}`)}if(s&&h.body){const x=h.body.getReader(),l=new TextDecoder;let p="",u="";for(;;){const{done:m,value:g}=await x.read();if(m)break;u+=l.decode(g,{stream:!0});const r=u.split(`
`);u=r.pop()||"";for(const y of r){const v=y.trim();if(v&&v.startsWith("data: ")){const C=v.slice(6);if(C==="[DONE]")continue;try{const A=JSON.parse(C).choices?.[0]?.delta?.content||"";A&&(p+=A,s(A))}catch(N){console.warn("Failed to parse streaming chunk:",N)}}}}if(u.trim()){const m=u.trim();if(m.startsWith("data: ")){const g=m.slice(6);if(g!=="[DONE]")try{const y=JSON.parse(g).choices?.[0]?.delta?.content||"";y&&(p+=y,s(y))}catch{}}}return p}return(await h.json()).choices[0]?.message?.content||"No response from API"}catch(d){throw console.error("Chat service error:",d),d}}async function Se(){const t=te();if(!t)return!1;try{const i=await fetch(`${I}/api/user/api-key/status`,{headers:{Authorization:`Bearer ${t}`}});if(i.ok){const s=await i.json();return s.hasApiKey||s.isAdmin}return!1}catch{return!1}}function Ne(t){const i=/\[\s*\n*\s*((?:[^[\]]*\\[a-zA-Z@]+[^[\]]*)+)\s*\n*\s*\]/g;return t.replace(i,(s,c)=>/\\[a-zA-Z@]+/.test(c)?`\\[${c.trim().replace(/\n\s*\n+/g,`
`).replace(/^\s+|\s+$/gm,"")}\\]`:s)}function Ee({selectedText:t,onToggleLayout:i,layout:s}){const{theme:c}=Q(),{isAuthenticated:o,user:d}=H(),[h,w]=a.useState([]),[x,l]=a.useState(""),[p,u]=a.useState(!1),[m,g]=a.useState(null),[r,y]=a.useState(!0),[v,C]=a.useState(!0),[N,A]=a.useState(fe),[b,j]=a.useState(!1),O=a.useRef(null),M=a.useRef(null),R=a.useRef(null),P=a.useRef(null),T=a.useRef(null),[$,G]=a.useState(null),K=()=>{O.current?.scrollIntoView({behavior:"smooth"})},F=()=>{const n=M.current;if(n){n.style.height="auto";const S=Math.min(Math.max(n.scrollHeight,24),200);n.style.height=`${S}px`}};a.useEffect(()=>{K()},[h]),a.useEffect(()=>{M.current?.focus(),F()},[]),a.useEffect(()=>{const n=setTimeout(()=>{F()},0);return()=>clearTimeout(n)},[x]),a.useEffect(()=>{(async()=>{if(o){const f=await Se();y(!f)}else y(!0)})()},[o,d]),a.useEffect(()=>{s==="split"&&C(!1)},[s]),a.useEffect(()=>{if(!b){G(null);return}const n=()=>{if(P.current){const _=P.current.getBoundingClientRect(),E=Math.max(_.width,220);G({width:E})}};n();const f=setTimeout(n,10),k=requestAnimationFrame(n),S=setTimeout(n,50);return window.addEventListener("scroll",n,!0),window.addEventListener("resize",n),()=>{clearTimeout(f),clearTimeout(S),cancelAnimationFrame(k),window.removeEventListener("scroll",n,!0),window.removeEventListener("resize",n)}},[b]),a.useEffect(()=>{if(!b)return;const n=k=>{const S=k.target;P.current&&T.current&&!P.current.contains(S)&&!T.current.contains(S)&&j(!1)},f=setTimeout(()=>{document.addEventListener("mousedown",n)},100);return()=>{clearTimeout(f),document.removeEventListener("mousedown",n)}},[b]);const U=n=>{A(n),j(!1)},q=()=>{if(r)return"Select Model";const n=D.find(f=>f.id===N);return n?n.name:"Select Model"},V=async()=>{const n=x.trim();if(!n&&!t)return;if(!o){g("Please sign in to use the chat feature.");return}if(r){g("Please configure your OpenRouter API key in Settings.");return}v&&C(!1),R.current&&R.current.abort(),R.current=new AbortController;let f=n;t&&!n?f=`Tell me about this: ${t}`:t&&n&&(f=`${n}

Context from PDF: ${t}`);const k={id:Date.now().toString(),role:"user",content:f};w(E=>[...E,k]),l(""),setTimeout(()=>{F()},0),u(!0),g(null);const S=(Date.now()+1).toString(),_={id:S,role:"assistant",content:""};w(E=>[...E,_]);try{const E=h.slice(-10).map(L=>({role:L.role,content:L.content}));let B="";await be([...E,k],t&&!n?t:void 0,L=>{B+=L,w(oe=>oe.map(W=>W.id===S?{...W,content:B}:W)),K()},N)}catch(E){console.error("Error sending message:",E),g(E instanceof Error?E.message:"Failed to send message"),w(B=>B.filter(L=>L.id!==S))}finally{u(!1),R.current=null,M.current?.focus()}},ne=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),V())},se=()=>{t&&(l(`Tell me about this: ${t}`),M.current?.focus())},Z=()=>{w([]),g(null)};return e.jsxs("div",{className:"chatgpt-wrapper",children:[!o&&s==="floating"&&e.jsxs("div",{className:"api-key-warning-outer",children:[e.jsx("span",{children:"ðŸ” Please sign in to use the chat feature"}),e.jsx("span",{className:"warning-hint",children:'Click "Sign in with Google" in the navigation bar'})]}),o&&r&&s==="floating"&&e.jsxs("div",{className:"api-key-warning-outer",children:[e.jsx("span",{children:"âš ï¸ OpenRouter API key not configured"}),e.jsx("span",{className:"warning-hint",children:d?.role==="admin"?"Admin API key not configured on server":"Add your API key in Settings (click the gear icon)"})]}),s==="floating"&&e.jsxs("div",{className:`model-selector-bar ${c==="dark"?"theme-dark":"theme-light"}`,children:[e.jsxs("div",{className:"model-selector-wrapper",ref:P,children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const f=!b;j(f),f||G(null)},className:"model-selector-button",title:"Select AI model",disabled:r,children:[e.jsx("span",{className:"model-selector-text",children:q()}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:b?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]}),b&&e.jsx("div",{ref:T,className:"model-selector-dropdown",onClick:n=>n.stopPropagation(),onMouseDown:n=>n.stopPropagation(),style:$?{width:`${$.width}px`}:void 0,children:D.map(n=>e.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),U(n.id)},className:`model-option ${N===n.id?"selected":""}`,children:[e.jsxs("div",{className:"model-option-content",children:[e.jsx("span",{className:"model-option-name",children:n.name}),e.jsx("span",{className:"model-option-provider",children:n.provider})]}),N===n.id&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]},n.id))})]}),e.jsxs("div",{className:"header-actions",children:[h.length>0&&e.jsx("button",{onClick:Z,className:"clear-button",title:"Clear chat",children:"Clear"}),s==="floating"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"layout-toggle-button",title:s==="floating"?"Switch to split layout":"Switch to floating layout","aria-label":s==="floating"?"Switch to split layout":"Switch to floating layout",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s==="floating"?e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("line",{x1:"10",y1:"3",x2:"10",y2:"10"}),e.jsx("line",{x1:"3",y1:"10",x2:"10",y2:"10"})]}):e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]})})}),e.jsx("button",{onClick:()=>C(!v),className:"collapse-button",title:v?"Expand chat":"Collapse chat","aria-label":v?"Expand chat":"Collapse chat",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:v?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M18 15l-6-6-6 6"})})})]})]})]}),e.jsxs("div",{className:`chatgpt-inner ${c==="dark"?"theme-dark":"theme-light"} ${v&&s==="floating"?"collapsed":""}`,children:[t&&e.jsxs("div",{className:"selected-text-banner",children:[e.jsx("span",{className:"banner-text",children:"Selected text available"}),e.jsx("button",{onClick:se,className:"use-text-button",children:"Use in chat"})]}),(!v||s==="split")&&e.jsxs("div",{className:"chatgpt-messages",children:[h.length===0&&e.jsxs("div",{className:"welcome-screen",children:[e.jsx("div",{className:"welcome-icon",children:e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"#10a37f",opacity:"0.1"}),e.jsx("path",{d:"M6 9H18M6 13H14",stroke:"#10a37f",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("h3",{children:"How can I help you today?"}),e.jsx("p",{children:"Ask me anything about your PDF, or select text to get context-specific answers."})]}),h.map(n=>e.jsxs("div",{className:`message ${n.role==="user"?"message-user":"message-assistant"}`,children:[e.jsx("div",{className:"message-avatar",children:n.role==="user"?e.jsx("div",{className:"avatar-user",children:"U"}):e.jsx("div",{className:"avatar-assistant",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"currentColor"})})})}),e.jsx("div",{className:"message-content-wrapper",children:e.jsx("div",{className:"message-content",children:n.role==="assistant"&&p&&!n.content?e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):n.role==="assistant"&&n.content?e.jsx("div",{className:"markdown-content",children:e.jsx(re,{remarkPlugins:[de,ue],rehypePlugins:[ce],components:{table:({children:f,...k})=>e.jsx("div",{className:"table-scroll-wrapper",children:e.jsx("table",{...k,children:f})}),div:({children:f,className:k,...S})=>k&&(k.includes("katex-display")||k.includes("math-display"))?e.jsx("div",{className:`math-scroll-wrapper ${k}`,...S,children:f}):e.jsx("div",{...S,className:k,children:f}),pre:({children:f,...k})=>e.jsx("pre",{className:"code-scroll-wrapper",...k,children:f})},children:Ne(n.content)})}):e.jsx("div",{className:"markdown-content",children:n.content})})})]},n.id)),m&&e.jsxs("div",{className:"error-message",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("div",{className:"error-text",children:m})]}),e.jsx("div",{ref:O})]}),!o&&s==="split"&&e.jsxs("div",{className:"api-key-warning-split-top",children:[e.jsx("span",{children:"ðŸ” Please sign in to use the chat feature"}),e.jsx("span",{className:"warning-hint",children:'Click "Sign in with Google" in the navigation bar'})]}),o&&r&&s==="split"&&e.jsxs("div",{className:"api-key-warning-split-top",children:[e.jsx("span",{children:"âš ï¸ OpenRouter API key not configured"}),e.jsx("span",{className:"warning-hint",children:d?.role==="admin"?"Admin API key not configured on server":"Add your API key in Settings (click the gear icon)"})]}),s==="split"&&e.jsxs("div",{className:`model-selector-bar ${c==="dark"?"theme-dark":"theme-light"}`,children:[e.jsxs("div",{className:"model-selector-wrapper",ref:P,children:[e.jsxs("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation();const f=!b;j(f),f||G(null)},className:"model-selector-button",title:"Select AI model",disabled:r||!o,children:[e.jsx("span",{className:"model-selector-text",children:q()}),e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{transform:b?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:e.jsx("path",{d:"M6 9l6 6 6-6"})})]}),b&&e.jsx("div",{ref:T,className:"model-selector-dropdown",onClick:n=>n.stopPropagation(),onMouseDown:n=>n.stopPropagation(),style:$?{width:`${$.width}px`}:void 0,children:D.map(n=>e.jsxs("button",{type:"button",onClick:f=>{f.preventDefault(),f.stopPropagation(),U(n.id)},className:`model-option ${N===n.id?"selected":""}`,children:[e.jsxs("div",{className:"model-option-content",children:[e.jsx("span",{className:"model-option-name",children:n.name}),e.jsx("span",{className:"model-option-provider",children:n.provider})]}),N===n.id&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})]},n.id))})]}),h.length>0&&e.jsx("button",{onClick:Z,className:"clear-button",title:"Clear chat",children:"Clear"}),e.jsx("button",{onClick:i,className:"layout-toggle-button",title:"Switch to floating layout","aria-label":"Switch to floating layout",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("line",{x1:"10",y1:"3",x2:"10",y2:"10"}),e.jsx("line",{x1:"3",y1:"10",x2:"10",y2:"10"})]})})]}),e.jsx("div",{className:"chatgpt-input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx("textarea",{ref:M,value:x,onChange:n=>l(n.target.value),onKeyPress:ne,placeholder:"Ask a question...",rows:1,className:"chatgpt-input",disabled:p||r||!o}),e.jsx("button",{onClick:V,disabled:!x.trim()&&!t||p||r||!o,className:"send-button",title:"Send message",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})]}),s==="floating"&&e.jsx("div",{className:`footer-text-outer ${c==="dark"?"theme-dark":"theme-light"}`,children:e.jsx("span",{className:"footer-text",children:"AI responses may contain errors. Please verify important information."})})]})}class Ce extends a.Component{constructor(i){super(i),this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#666",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{maxWidth:"400px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"PDF Viewer Temporarily Unavailable"}),e.jsx("p",{style:{marginBottom:"20px"},children:"There's a configuration issue with the PDF viewer. The rest of the app is working fine!"}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",marginBottom:"20px"},children:["Error: ",this.state.error?.message||"Unknown error"]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("label",{htmlFor:"pdf-upload-fallback",style:{padding:"12px 24px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"500",cursor:"pointer",display:"inline-block"},children:"Upload PDF (Basic)"}),e.jsx("input",{id:"pdf-upload-fallback",type:"file",accept:"application/pdf",onChange:i=>{const s=i.target.files?.[0];s&&alert(`PDF "${s.name}" selected. PDF viewing will work once the configuration issue is resolved.`)},style:{display:"none"}})]}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Try Again"})]})}):this.props.children}}const Ae=a.lazy(()=>ge(()=>import("./PDFViewer-BpxVOLHw.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function Pe(){const[t,i]=a.useState(null),[s,c]=a.useState(""),[o,d]=a.useState("floating"),h=l=>{i(l)},w=l=>{c(l)},x=()=>{d(l=>l==="floating"?"split":"floating")};return e.jsx(me,{children:e.jsx(xe,{children:e.jsxs("div",{className:"app",children:[e.jsx(ve,{}),e.jsxs("div",{className:`main-content ${o==="split"?"split-layout":""}`,children:[e.jsx(Ce,{children:e.jsx(a.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading PDF viewer..."}),children:e.jsx(Ae,{file:t,onFileUpload:h,onTextSelection:w,layout:o})})}),e.jsx("div",{className:`chat-container ${o==="floating"?"floating-chat":"split-chat"}`,children:e.jsx(Ee,{selectedText:s,onToggleLayout:x,layout:o})})]})]})})})}const z=document.getElementById("root");if(!z)throw new Error("Root element not found");try{ie.createRoot(z).render(e.jsx(ae.StrictMode,{children:e.jsx(Pe,{})}))}catch(t){z.innerHTML=`
    <div style="padding: 20px; color: red;">
      <h1>Error Loading App</h1>
      <p>${t instanceof Error?t.message:String(t)}</p>
      <p>Check the browser console for more details.</p>
    </div>
  `}
