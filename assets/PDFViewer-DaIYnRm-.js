const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-CLrFw-IM.js","assets/vendor-C5EChc_d.css"])))=>i.map(i=>d[i]);
import{r as d,j as e,a as It,D as At,P as Ot}from"./vendor-react-BWK-dEaB.js";import{_ as Bt,C as Yt}from"./index-LSZ7S7r9.js";import{G as Rt}from"./vendor-pdf-DDxsMbbh.js";import"./vendor-CLrFw-IM.js";const _t=({pageNumber:u,pageWidth:j,pageHeight:T,scale:m,annotations:z,selectedAnnotationId:i,onAnnotationUpdate:c,onAnnotationDelete:g,onAnnotationSelect:v,mode:G})=>{const k=d.useRef(null),[R,nt]=d.useState(!1),[s,q]=d.useState(!1),[r,at]=d.useState(!1),[rt,dt]=d.useState({x:0,y:0}),[U,P]=d.useState(null),[M,A]=d.useState(null),[J,pt]=d.useState({x:0,y:0,angle:0}),[p,O]=d.useState(null),_=z.filter(o=>o.pageNumber===u),N=o=>o*j*m,V=o=>o*T*m,D=o=>o*j*m,lt=o=>o*T*m,tt=o=>o/(j*m),yt=o=>o/(T*m),F=d.useCallback((o,S,W,y)=>{const h=1-W,x=1-y;return{x:Math.max(0,Math.min(h,o)),y:Math.max(0,Math.min(x,S)),width:Math.max(.01,Math.min(1,W)),height:Math.max(.01,Math.min(1,y))}},[]),ht=d.useCallback((o,S,W,y)=>{const h=document.createElement("div");h.style.position="absolute",h.style.visibility="hidden",h.style.width=`${W}px`,h.style.fontSize=`${S*y}px`,h.style.fontFamily="inherit",h.style.whiteSpace="pre-wrap",h.style.wordWrap="break-word",h.style.overflowWrap="break-word",h.style.padding=`${4*y}px`,h.style.boxSizing="border-box",h.style.lineHeight="1.2",h.textContent=o||"Text",document.body.appendChild(h);const x=h.scrollHeight;return document.body.removeChild(h),x},[]),wt=d.useCallback((o,S)=>{o.stopPropagation();const W=o.target;if(W.classList.contains("resize-handle")){o.preventDefault(),q(!0),P(W.dataset.handle||null);const h=k.current?.getBoundingClientRect();h&&(dt({x:o.clientX-h.left,y:o.clientY-h.top}),A({x:o.clientX-h.left,y:o.clientY-h.top,width:S.width,height:S.height,annotationX:S.x,annotationY:S.y}));return}if(W.classList.contains("rotate-handle")){o.preventDefault(),at(!0);const h=k.current?.getBoundingClientRect();if(h){const x=N(S.x+S.width/2),b=V(S.y+S.height/2),w=o.clientX-h.left,H=o.clientY-h.top,X=Math.atan2(H-b,w-x)*(180/Math.PI);pt({x:w,y:H,angle:S.rotation-X})}return}if(W.classList.contains("delete-button")){o.preventDefault(),g(S.id);return}o.preventDefault(),v(S.id),nt(!0);const y=k.current?.getBoundingClientRect();y&&dt({x:o.clientX-y.left-N(S.x),y:o.clientY-y.top-V(S.y)})},[G,N,V,v,g]);d.useEffect(()=>{if(!R&&!s&&!r)return;const o=W=>{const y=k.current?.getBoundingClientRect();if(!y)return;const h=_.find(x=>x.id===i);if(h){if(r){const x=N(h.x+h.width/2),b=V(h.y+h.height/2),w=W.clientX-y.left,H=W.clientY-y.top,X=Math.atan2(H-b,w-x)*(180/Math.PI),C=(J.angle+X)%360;c({...h,rotation:C})}else if(s&&U&&M){const x=W.clientX-y.left,b=W.clientY-y.top,w=x-M.x,H=b-M.y,X=.5,C=w/(j*m)*X,Q=H/(T*m)*X;let B=M.annotationX,mt=M.annotationY,st=M.width,vt=M.height;U.includes("n")&&(mt=Math.max(0,M.annotationY+Q),vt=Math.max(.01,M.height-Q)),U.includes("s")&&(vt=Math.max(.01,M.height+Q)),U.includes("w")&&(B=Math.max(0,M.annotationX+C),st=Math.max(.01,M.width-C)),U.includes("e")&&(st=Math.max(.01,M.width+C));const ut=F(B,mt,st,vt);if(h.type==="textbox"){const kt=h,Pt=D(ut.width),Dt=ht(kt.text,kt.fontSize,Pt,m)/(T*m);if(Math.abs(Dt-ut.height)>.001){const Ft=Math.max(.01,Math.min(1,Dt)),Tt=F(B,mt,ut.width,Ft);c({...h,...Tt})}else c({...h,...ut})}else c({...h,...ut})}else if(R){const x=tt(W.clientX-y.left-rt.x),b=yt(W.clientY-y.top-rt.y),w=F(x,b,h.width,h.height);c({...h,...w})}}},S=()=>{if(s&&i){const W=_.find(y=>y.id===i);if(W&&W.type==="textbox"){const y=W,h=D(y.width),b=ht(y.text,y.fontSize,h,m)/(T*m),w=F(y.x,y.y,y.width,b);Math.abs(w.height-y.height)>.001&&c({...y,...w})}}nt(!1),q(!1),at(!1),P(null),A(null)};return window.addEventListener("mousemove",o),window.addEventListener("mouseup",S),()=>{window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",S)}},[R,s,r,U,M,rt,J,i,_,N,V,D,lt,tt,yt,F,ht,c,j,T,m]),d.useEffect(()=>{const o=S=>{(S.key==="Delete"||S.key==="Backspace")&&i&&S.target.tagName!=="INPUT"&&S.target.tagName!=="TEXTAREA"&&(S.preventDefault(),g(i))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[i,g]);const bt=o=>{const S=o.id===i,W=N(o.x),y=V(o.y),h=D(o.width),x=lt(o.height);return e.jsxs("div",{className:`annotation textbox-annotation ${S?"selected":""}`,style:{left:`${W}px`,top:`${y}px`,width:`${h}px`,height:`${x}px`,padding:`${4*m}px`,transform:`rotate(${o.rotation}deg)`,transformOrigin:"center center"},onMouseDown:b=>wt(b,o),children:[S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"delete-button",onClick:b=>{b.stopPropagation(),g(o.id)},title:"Delete (or press Delete key)",children:"×"}),e.jsx("div",{className:"resize-handle","data-handle":"ne"}),e.jsx("div",{className:"resize-handle","data-handle":"sw"}),e.jsx("div",{className:"resize-handle","data-handle":"se"}),e.jsx("div",{className:"resize-handle","data-handle":"n"}),e.jsx("div",{className:"resize-handle","data-handle":"s"}),e.jsx("div",{className:"resize-handle","data-handle":"w"}),e.jsx("div",{className:"resize-handle","data-handle":"e"}),e.jsx("div",{className:"rotate-handle"})]}),p===o.id?e.jsx("textarea",{className:"textbox-input",value:o.text,onChange:b=>{c({...o,text:b.target.value})},onBlur:b=>{const w=b.relatedTarget;w&&(w.closest(".textbox-controls")!==null||w.closest(".textbox-font-size-input")!==null||w.classList.contains("textbox-font-size-input"))||(O(null),v(null))},onKeyDown:b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),O(null),v(null)),b.key==="Escape"&&(O(null),v(null))},style:{fontSize:`${o.fontSize*m}px`,color:o.color,width:`${h}px`,maxWidth:`${h}px`,height:`${x}px`,maxHeight:`${x}px`},autoFocus:!0}):e.jsx("div",{className:"textbox-content",onClick:b=>{b.stopPropagation();const w=b.target;w.closest(".textbox-controls")!==null||w.closest(".textbox-font-size-input")!==null||w.closest(".textbox-color-button")!==null||w.closest(".textbox-color-picker")!==null||O(o.id)},style:{fontSize:`${o.fontSize*m}px`,color:o.color},children:o.text||"Text"})]},o.id)},St=o=>{const S=o.id===i,W=N(o.x),y=V(o.y),h=D(o.width),x=lt(o.height),b=o.width*j,w=o.height*T,H=o.imageWidth/o.imageHeight,X=b/w;let C,Q;return H>X?(C=h,Q=h/H):(Q=x,C=x*H),e.jsxs("div",{className:`annotation image-annotation ${S?"selected":""}`,style:{left:`${W}px`,top:`${y}px`,width:`${C}px`,height:`${Q}px`,transform:`rotate(${o.rotation}deg)`,transformOrigin:"center center"},onMouseDown:B=>wt(B,o),children:[S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"delete-button",onClick:B=>{B.stopPropagation(),g(o.id)},title:"Delete (or press Delete key)",children:"×"}),e.jsx("div",{className:"resize-handle","data-handle":"ne"}),e.jsx("div",{className:"resize-handle","data-handle":"sw"}),e.jsx("div",{className:"resize-handle","data-handle":"se"}),e.jsx("div",{className:"resize-handle","data-handle":"n"}),e.jsx("div",{className:"resize-handle","data-handle":"s"}),e.jsx("div",{className:"resize-handle","data-handle":"w"}),e.jsx("div",{className:"resize-handle","data-handle":"e"}),e.jsx("div",{className:"rotate-handle"})]}),e.jsx("img",{src:o.imageData,alt:"Annotation",draggable:!1})]},o.id)},jt=j*m,Nt=T*m,zt={width:`${jt}px`,height:`${Nt}px`,pointerEvents:"none"};return e.jsx("div",{ref:k,className:"annotation-layer",style:zt,children:_.map(o=>o.type==="textbox"?bt(o):o.type==="image"?St(o):null)})},Ut=({mode:u,onModeChange:j,onImageUpload:T,onDownload:m,onClearAll:z})=>{const i=d.useRef(null),[c,g]=d.useState(!1),v=d.useRef(null);It.useEffect(()=>{const R=nt=>{c&&(nt.target.closest(".clear-button")||(g(!1),v.current&&(clearTimeout(v.current),v.current=null)))};if(c)return document.addEventListener("click",R),()=>{document.removeEventListener("click",R)}},[c]);const G=R=>{const nt=R.target.files?.[0];nt&&nt.type.startsWith("image/")&&T(nt),j(null),i.current&&(i.current.value="")},k=R=>{R.stopPropagation(),c?(z&&z(),g(!1),v.current&&(clearTimeout(v.current),v.current=null)):(g(!0),v.current=setTimeout(()=>{g(!1),v.current=null},3e3))};return e.jsxs("div",{className:"annotation-toolbar",children:[e.jsxs("div",{className:"toolbar-section",children:[e.jsxs("button",{className:`toolbar-button ${u==="textbox"?"active":""}`,onClick:()=>j("textbox"),title:"Add text box (click on PDF to add)",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M4 20h16"}),e.jsx("path",{d:"M6 4v16"}),e.jsx("path",{d:"M18 4v16"}),e.jsx("path",{d:"M4 7h16"}),e.jsx("path",{d:"M4 10h16"}),e.jsx("path",{d:"M4 13h16"}),e.jsx("path",{d:"M4 16h16"})]}),e.jsx("span",{className:"toolbar-button-text",children:"Text"})]}),e.jsxs("button",{className:`toolbar-button ${u==="image"?"active":""}`,onClick:()=>{j("image"),i.current?.click()},title:"Add image (click to upload)",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:"toolbar-button-text",children:"Image"})]}),z&&e.jsxs("button",{className:`toolbar-button clear-button ${c?"confirming":""}`,onClick:k,title:c?"Click again to clear all annotations":"Clear all annotations",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]}),e.jsx("span",{className:"toolbar-button-text",children:"Clear All"})]}),e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:G,style:{display:"none"}})]}),e.jsx("div",{className:"toolbar-section toolbar-actions",children:e.jsxs("button",{className:"toolbar-button download-button",onClick:m,title:"Download annotated PDF",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),e.jsx("span",{className:"toolbar-button-text",children:"Download"})]})})]})},Vt=({pageNumber:u,pageWidth:j,pageHeight:T,scale:m,knowledgeNotes:z,showKnowledgeNotes:i,onNoteClick:c})=>{const g=z.filter(k=>k.pageNumber===u);if(!i||g.length===0)return null;const v=j*m,G=T*m;return e.jsx("div",{className:"knowledge-note-connections",style:{width:`${v}px`,height:`${G}px`,position:"absolute",top:0,left:0,pointerEvents:"none",zIndex:5},children:e.jsx("svg",{className:"connection-svg",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"visible"},children:g.map((k,R)=>{const nt=v-25,s=25+R*35;return e.jsxs("g",{children:[e.jsx("circle",{cx:nt,cy:s,r:"10",fill:"#4285f4",stroke:"white",strokeWidth:"2",className:"knowledge-note-marker",onClick:q=>{q.stopPropagation(),c?.(k)},style:{cursor:"pointer",pointerEvents:"all"}}),e.jsx("text",{x:nt,y:s,textAnchor:"middle",dominantBaseline:"middle",fill:"white",fontSize:"11",fontWeight:"bold",pointerEvents:"none",children:R+1}),e.jsx("line",{x1:nt,y1:s+12,x2:nt,y2:s+20,stroke:"#4285f4",strokeWidth:"2",opacity:"0.7"})]},k.id)})})})};let Et,Ct=null,Ht=!1;async function Zt(){if(!Et)try{Et=await Bt(()=>import("./vendor-CLrFw-IM.js").then(u=>u.o),__vite__mapDeps([0,1]))}catch(u){throw console.error("Failed to load pdf-lib:",u),new Error("PDF library not available. Please install pdf-lib.")}return Et}async function qt(){if(!Ht){Ht=!0;try{const u=await Bt(()=>import("./vendor-CLrFw-IM.js").then(j=>j.p),__vite__mapDeps([0,1]));return u.default?Ct=u.default:Ct=u,Ct&&typeof Ct.create=="function"?Ct:(console.warn("Fontkit module loaded but does not have create method"),null)}catch(u){return console.warn("Failed to load fontkit, falling back to standard fonts:",u),null}}return Ct}async function Kt(){try{const u=["https://unpkg.com/@fontsource/noto-sans@5/files/noto-sans-all-400-normal.woff2","https://raw.githubusercontent.com/google/fonts/main/ofl/notosans/NotoSans-Regular.ttf","https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap"],j="/ChatNote/",m=`${j.endsWith("/")?j:`${j}/`}NotoSans-Regular.ttf`;try{const z=await fetch(m);if(z.ok){const i=await z.arrayBuffer();if(i.byteLength>1e3){const c=new Uint8Array(i);if(c.length>=4&&c[0]===0&&c[1]===1&&c[2]===0&&c[3]===0)return i}}}catch(z){console.debug("Local font file not found, trying CDN:",z)}for(const z of u)if(!z.includes("fonts.googleapis.com/css"))try{const i=await fetch(z,{mode:"cors",cache:"default"});if(i.ok){const c=await i.arrayBuffer();if(c.byteLength>1e3){const g=new Uint8Array(c),v=g.length>=4&&g[0]===0&&g[1]===1&&g[2]===0&&g[3]===0,G=g.length>=4&&g[0]===119&&g[1]===79&&g[2]===70&&g[3]===70,k=g.length>=4&&g[0]===119&&g[1]===79&&g[2]===70&&g[3]===50;if(v||G||k)return console.log(`Successfully loaded Unicode font from CDN (${v?"TTF":G?"WOFF":"WOFF2"})`),c;console.debug(`File from ${z} doesn't appear to be a font file`);continue}}}catch(i){console.debug(`Failed to load font from ${z}:`,i);continue}return console.warn("All font loading methods failed. To enable Unicode support, please download NotoSans-Regular.ttf and place it in the public/ folder."),null}catch(u){return console.warn("Failed to load Unicode font:",u),null}}async function Gt(u,j,T){try{const m=await Zt(),{PDFDocument:z,rgb:i,degrees:c,StandardFonts:g}=m;if(!g)throw new Error("StandardFonts not available from pdf-lib");const v=await u.arrayBuffer(),G=await z.load(v);let k=null;try{const s=await qt();if(s){try{G.registerFontkit(s)}catch(r){(!r.message||!r.message.includes("already registered"))&&console.warn("Failed to register fontkit:",r)}const q=await Kt();if(q){const r=new Uint8Array(q),at=r.length>=4&&r[0]===0&&r[1]===1&&r[2]===0&&r[3]===0,rt=r.length>=4&&r[0]===79&&r[1]===84&&r[2]===84&&r[3]===79,dt=r.length>=4&&r[0]===116&&r[1]===116&&r[2]===99&&r[3]===102,U=r.length>=4&&r[0]===119&&r[1]===79&&r[2]===70&&r[3]===70,P=r.length>=4&&r[0]===119&&r[1]===79&&r[2]===70&&r[3]===50;U||P?console.warn("Font file is WOFF/WOFF2 format, fontkit requires TTF/OTF. Font will not be embedded."):at||rt||dt?k=await G.embedFont(q):console.warn(`Invalid font format. File size: ${r.length} bytes`)}}}catch(s){console.warn("Failed to embed Unicode font, falling back to standard font:",s)}if(!k){const s=g.Helvetica||g.TimesRoman;if(!s)throw new Error("No standard font available");k=await G.embedFont(s),console.log("Using standard font (limited Unicode support)")}if(!k)throw new Error("Failed to embed font");const R=G.getPages();for(const s of j){const q=R[s.pageNumber-1];if(!q)continue;const r=q.getSize(),at=r.width,rt=r.height,dt=T.get(s.pageNumber);if(!dt)continue;const{width:U,height:P}=dt;console.log(`[PDF Save] Page ${s.pageNumber} dimensions comparison:`,{storedWidth:U,storedHeight:P,actualPdfWidth:at,actualPdfHeight:rt,widthMatch:Math.abs(U-at)<.1,heightMatch:Math.abs(P-rt)<.1,widthDiff:U-at,heightDiff:P-rt});let M=s.width*U,A=s.height*P;const J=s.x*U,pt=s.y*P;if(console.log(`[PDF Save] Annotation on page ${s.pageNumber}:`,{annotationType:s.type,relativeX:s.x,relativeY:s.y,relativeWidth:s.width,relativeHeight:s.height,pageWidth:U,pageHeight:P,pdfWidth:M,pdfHeight:A,pdfX:J,pdfY:pt,...s.type==="textbox"?{textBoxInfo:"See detailed text box logging below"}:{}}),s.type==="textbox"){const p=s,O=Jt(p.color)||{r:0,g:0,b:0},_=s.x*U,N=s.y*P;let V=(s.y+s.height)*P;console.log(`[PDF Save] Text Box Details for page ${s.pageNumber}:`,{relativeX:s.x,relativeY:s.y,relativeWidth:s.width,relativeHeight:s.height,pageWidth:U,pageHeight:P,webLeftX:_,webTopY:N,webBottomY:V,pdfWidth:M,pdfHeight:A,savedPdfX:_,savedPdfY:V,savedPdfTopY:N,containerPdfWidth:M,containerPdfHeight:A});const D=4,lt=M-D*2,tt=(p.text||"").trimEnd();let F=tt.split(/\r\n|\r|\n/).filter(x=>x!=null);for(;F.length>0&&F[F.length-1].length===0;)F.pop();if(F.length===0&&(F=[""]),F.length===1&&k&&typeof k.widthOfTextAtSize=="function"){const x=F[0],b=lt;let w;try{w=k.widthOfTextAtSize(x,p.fontSize)}catch{w=x.length*p.fontSize*.5}if(console.log(`[PDF Save] Text Wrapping Check for page ${s.pageNumber}:`,{text:x,textLength:x.length,fontSize:p.fontSize,textWidth:w,maxWidth:b,contentWidth:lt,containerPdfWidth:M,padding:D,needsWrapping:w>b}),w>b){const H=[],X=x.split(/(\s+)/);let C="";for(let Q=0;Q<X.length;Q++){const B=X[Q],mt=C+B;let st;try{st=k.widthOfTextAtSize(mt,p.fontSize)}catch{st=mt.length*p.fontSize*.5}st<=b||C===""?C=mt:(C.trim()&&H.push(C.trim()),C=B)}C.trim()&&H.push(C.trim()),H.length>1&&(console.log(`[PDF Save] Text wrapped from 1 line to ${H.length} lines:`,{originalText:x,wrappedLines:H,maxWidth:b,textWidth:w}),F=H)}}const ht=p.fontSize*1.2,wt=F.length>0?(F.length-1)*ht+p.fontSize+D*2:p.fontSize+D*2;A=wt;const bt=N+A;console.log(`[PDF Save] Final text lines for page ${s.pageNumber}:`,{lineCount:F.length,lines:F,storedRelativeHeight:s.height,storedPdfHeight:s.height*P,actualContentHeight:wt,recalculatedPdfHeight:A,webTopY:N,originalWebBottomY:V,recalculatedWebBottomY:bt,fontSize:p.fontSize,lineHeight:ht}),V=bt;const St=P-V,jt=P-N,Nt=jt-St,zt=St+Nt/2,o=zt,S=p.fontSize*.2,W=P-p.fontSize*.2,y=Math.max(S,Math.min(W,o));if(console.log(`[PDF Save] Text positioning for page ${s.pageNumber}:`,{webTopY:N,webBottomY:V,pdfTopY:jt,pdfBottomY:St,textBoxHeight:Nt,textCenterY:zt,finalPdfY:y,actualContentHeight:A}),(F.length>1||tt.includes(`
`)||tt.includes("\r"))&&F.length>0)try{const x=(F.length-1)*ht,b=y+x/2;F.forEach((w,H)=>{const X=b-H*ht;let C;try{k&&typeof k.widthOfTextAtSize=="function"?C=k.widthOfTextAtSize(w,p.fontSize):C=w.length*p.fontSize*.5}catch{C=w.length*p.fontSize*.5}let B=_+D+lt/2-C/2;const mt=_+D,st=_+M-C-D;B=Math.max(mt,Math.min(st,B));const vt=w.length>0?w:" ";q.drawText(vt,{x:B,y:X,size:p.fontSize,color:i(O.r/255,O.g/255,O.b/255),rotate:c(p.rotation),font:k})})}catch(x){if(x.message&&x.message.includes("cannot encode")){console.warn("Unicode character encoding failed, replacing unsupported characters:",x.message);const b=F.map(X=>X.split("").map(C=>C.charCodeAt(0)>255?"?":C).join("")),w=(b.length-1)*ht,H=y+w/2;try{b.forEach((X,C)=>{const Q=H-C*ht;let B;try{k&&typeof k.widthOfTextAtSize=="function"?B=k.widthOfTextAtSize(X,p.fontSize):B=X.length*p.fontSize*.5}catch{B=X.length*p.fontSize*.5}let st=_+D+lt/2-B/2;const vt=_+D,ut=_+M-B-D;st=Math.max(vt,Math.min(ut,st)),q.drawText(X,{x:st,y:Q,size:p.fontSize,color:i(O.r/255,O.g/255,O.b/255),rotate:c(p.rotation),font:k})}),console.log("Drew text with Unicode characters replaced")}catch(X){console.error("Failed to draw text even after replacing Unicode characters:",X);continue}}else throw x}else{let x;try{k&&typeof k.widthOfTextAtSize=="function"?x=k.widthOfTextAtSize(p.text,p.fontSize):x=p.text.length*p.fontSize*.5}catch{x=p.text.length*p.fontSize*.5}let w=_+D+lt/2-x/2;const H=_+D,X=_+M-x-D;w=Math.max(H,Math.min(X,w));try{q.drawText(p.text,{x:w,y,size:p.fontSize,color:i(O.r/255,O.g/255,O.b/255),rotate:c(p.rotation),font:k})}catch(C){if(C.message&&C.message.includes("cannot encode")){console.warn("Unicode character encoding failed, replacing unsupported characters:",C.message);const Q=p.text.split("").map(B=>B.charCodeAt(0)>255?"?":B).join("");try{q.drawText(Q,{x:w,y,size:p.fontSize,color:i(O.r/255,O.g/255,O.b/255),rotate:c(p.rotation),font:k}),console.log("Drew text with Unicode characters replaced")}catch(B){console.error("Failed to draw text even after replacing Unicode characters:",B);continue}}else throw C}}}else if(s.type==="image"){const p=s,O=await fetch(p.imageData).then(bt=>bt.arrayBuffer());let _;p.imageData.startsWith("data:image/png")?_=await G.embedPng(O):_=await G.embedJpg(O);const N=p.imageWidth/p.imageHeight;let V=M,D=A;M/A>N?V=A*N:D=M/N;const tt=s.x*U,yt=(s.y+s.height)*P,wt=P-yt+(A-D)/2;q.drawImage(_,{x:tt,y:wt,width:V,height:D,rotate:c(p.rotation)})}}const nt=await G.save();return new Blob([nt],{type:"application/pdf"})}catch(m){throw console.error("Error saving annotated PDF:",m),new Error("Failed to save annotated PDF")}}function Jt(u){const j=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(u);return j?{r:parseInt(j[1],16),g:parseInt(j[2],16),b:parseInt(j[3],16)}:null}function Qt(u,j="annotated.pdf"){const T=URL.createObjectURL(u),m=document.createElement("a");m.href=T,m.download=j,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(T)}const te=({selectedAnnotation:u,onUpdate:j})=>{const[T,m]=d.useState(u.fontSize.toString()),z=d.useRef(u.fontSize);return d.useEffect(()=>{z.current=u.fontSize,m(u.fontSize.toString())},[u.id,u.fontSize]),e.jsxs("div",{className:"textbox-controls",onClick:i=>{i.target.closest('input[type="number"]')||i.stopPropagation()},onMouseDown:i=>{i.target.closest('input[type="number"]')||i.stopPropagation()},children:[e.jsxs("div",{className:"textbox-control-group",children:[e.jsx("label",{className:"textbox-control-label",children:"Font Size:"}),e.jsxs("div",{className:"font-size-input-wrapper",children:[e.jsx("button",{type:"button",className:"font-size-arrow-button font-size-arrow-left",onClick:i=>{i.stopPropagation(),i.preventDefault();const c=parseInt(T,10)||z.current,g=Math.max(1,c-1);m(g.toString());const v={...u,fontSize:g};j(v),z.current=g},onMouseDown:i=>{i.stopPropagation(),i.preventDefault()},title:"Decrease font size",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("input",{type:"number",min:"1",max:"200",value:T,onChange:i=>{const c=i.target.value;if(m(c),c===""||c==="-")return;const g=parseInt(c,10);if(!isNaN(g)&&g>0){const v=Math.max(1,Math.min(200,g)),G={...u,fontSize:v};j(G),z.current=v}},onBlur:i=>{const c=i.target.value.trim();if(c===""||c==="-"||isNaN(parseInt(c,10))||parseInt(c,10)<=0)m(z.current.toString());else{const g=parseInt(c,10),v=Math.max(1,Math.min(200,g));v!==g&&m(v.toString()),z.current=v}},onMouseDown:i=>{i.stopPropagation()},onClick:i=>{i.stopPropagation()},onFocus:i=>{i.stopPropagation()},onWheel:i=>{i.stopPropagation()},className:"textbox-font-size-input"}),e.jsx("button",{type:"button",className:"font-size-arrow-button font-size-arrow-right",onClick:i=>{i.stopPropagation(),i.preventDefault();const c=parseInt(T,10)||z.current,g=Math.min(200,c+1);m(g.toString());const v={...u,fontSize:g};j(v),z.current=g},onMouseDown:i=>{i.stopPropagation(),i.preventDefault()},title:"Increase font size",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]})]}),e.jsxs("div",{className:"textbox-control-group",children:[e.jsx("label",{className:"textbox-control-label",children:"Color:"}),e.jsx("div",{className:"textbox-color-picker",children:Yt.map(i=>e.jsx("button",{className:`textbox-color-button ${u.color===i?"active":""}`,style:{backgroundColor:i},onClick:c=>{c.stopPropagation(),c.preventDefault(),j({...u,color:i})},onMouseDown:c=>{c.stopPropagation(),c.preventDefault()},onFocus:c=>{c.stopPropagation()},title:i},i))})]})]})};function se({file:u,onFileUpload:j,onTextSelection:T,layout:m="floating",onPageChange:z,showKnowledgeNotes:i=!0,onToggleKnowledgeNotes:c,knowledgeNotes:g=[],onScrollToPage:v,onNoteClick:G,onAddAnnotation:k}){const[R,nt]=d.useState(0),[s,q]=d.useState(1),[r,at]=d.useState(1),[rt,dt]=d.useState(!1),[U,P]=d.useState("100"),M=d.useRef(null),A=d.useRef(new Map),J=d.useRef(null),pt=d.useRef(null),p=d.useRef(null),O=d.useRef(null),_=d.useRef(!1),N=d.useRef(new Map),[V,D]=d.useState([]),[lt,tt]=d.useState(null),[yt,F]=d.useState(null),[ht,wt]=d.useState(!1);d.useEffect(()=>{const t=console.warn,n=console.error;return console.warn=(...a)=>{const f=a.join(" ");f.includes("TextLayer task cancelled")||f.includes("AbortException")||a.some(l=>typeof l=="string"&&(l.includes("TextLayer task cancelled")||l.includes("AbortException")))||t.apply(console,a)},console.error=(...a)=>{const f=a.join(" ");f.includes("TextLayer task cancelled")||f.includes("AbortException")&&f.includes("TextLayer")||n.apply(console,a)},()=>{console.warn=t,console.error=n}},[]);const bt=d.useMemo(()=>u?URL.createObjectURL(u):null,[u]);d.useEffect(()=>()=>{bt&&URL.revokeObjectURL(bt)},[bt]);const St=d.useMemo(()=>{let t;const n="https://unpkg.com/pdfjs-dist@5.4.394/standard_fonts/";{const a="/ChatNote/";t=`${a.endsWith("/")?a:`${a}/`}pdf.worker.min.js`}return Rt&&(Rt.workerSrc=t,Rt.standardFontDataUrl=n),{workerSrc:t,cMapUrl:"https://unpkg.com/pdfjs-dist@5.4.394/cmaps/",cMapPacked:!0,standardFontDataUrl:n,verbosity:0}},[]),jt=({numPages:t})=>{nt(t);const n=1;q(n),setTimeout(()=>{z?.(n)},0),A.current.clear(),N.current.clear(),D([]),tt(null)},Nt=t=>{if(!N.current.has(t.pageNumber))try{const n=t.page;let a,f,l;n.viewport?(a=n.viewport.width,f=n.viewport.height,l="viewport"):(a=n.width/r,f=n.height/r,l="page.width/scale fallback"),console.log(`[Page Dimensions] Page ${t.pageNumber}:`,{source:l,baseWidth:a,baseHeight:f,currentScale:r,pageWidth:n.width,pageHeight:n.height,viewportWidth:n.viewport?.width,viewportHeight:n.viewport?.height}),N.current.set(t.pageNumber,{width:a,height:f})}catch(n){console.warn("Error getting page dimensions:",n);const a=t.page,f=a.width/r,l=a.height/r;console.log(`[Page Dimensions] Page ${t.pageNumber} (fallback):`,{source:"error fallback",baseWidth:f,baseHeight:l,currentScale:r,pageWidth:a.width,pageHeight:a.height}),N.current.set(t.pageNumber,{width:f,height:l})}};d.useEffect(()=>{if(!J.current||R===0)return;let t=null,n=!1;const a=()=>{if(_.current||n||t)return;n=!0,t=setTimeout(()=>{t=null,n=!1},100);const l=J.current;if(!l){n=!1;return}const E=l.getBoundingClientRect(),K=E.top,$=E.height,Z=K+$/2;if(l.scrollTop<100){q(I=>I!==1?(setTimeout(()=>{z?.(1)},0),1):I);return}let ct=1,Y=0;for(let I=1;I<=R;I++){const L=A.current.get(I);if(L){const xt=L.getBoundingClientRect(),it=l.getBoundingClientRect(),gt=Math.max(it.top,xt.top),et=Math.min(it.bottom,xt.bottom),ft=Math.max(0,et-gt);ft>Y&&(Y=ft,ct=I)}}if(Y<$*.1){let I=1,L=1/0;for(let xt=1;xt<=R;xt++){const it=A.current.get(xt);if(it){const gt=it.getBoundingClientRect(),et=gt.top+gt.height/2,ft=Math.abs(et-Z);ft<L&&(L=ft,I=xt)}}ct=I}q(I=>ct!==I?(setTimeout(()=>{z?.(ct)},0),ct):I)},f=J.current;return f?.addEventListener("scroll",a,{passive:!0}),()=>{t&&clearTimeout(t),f?.removeEventListener("scroll",a)}},[R,z]);const zt=t=>{console.error("PDF load error:",t)},o=t=>{const n=t.target.files?.[0];n&&n.type==="application/pdf"&&j(n)},S=d.useCallback(t=>{const n=A.current.get(t);n&&J.current&&(_.current=!0,q(t),z?.(t),n.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{_.current=!1},1500))},[z]);d.useEffect(()=>(v&&(window.__pdfScrollToPage=S),J.current&&(window.__pdfContentRef=J.current),pt.current&&(window.__pdfViewerHeight=pt.current.clientHeight),()=>{delete window.__pdfScrollToPage,delete window.__pdfContentRef,delete window.__pdfViewerHeight}),[S,v,R,r]);const W=()=>{const t=Math.max(1,s-1);S(t)},y=()=>{const t=Math.min(R,s+1);S(t)},h=()=>{const t=Math.min(r+.2,5);at(t),P(Math.round(t*100).toString())},x=()=>{const t=Math.max(r-.2,.25);at(t),P(Math.round(t*100).toString())};d.useEffect(()=>{rt||P(Math.round(r*100).toString())},[r,rt]);const b=()=>{dt(!0),P(Math.round(r*100).toString())},w=t=>{let n=t.target.value;n=n.replace(/[^0-9]/g,""),n.length>1&&n.startsWith("0")&&(n=n.replace(/^0+/,"")||"0"),n.length>3&&(n=n.slice(0,3)),P(n)},H=()=>{Q()},X=t=>{if(t.key==="Enter")t.preventDefault(),Q();else if(t.key==="Escape")dt(!1),P(Math.round(r*100).toString()),M.current?.blur();else{if(t.key==="Backspace"||t.key==="Delete"||t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="Tab")return;(t.key==="-"||t.key==="+"||t.key==="."||t.key===","||t.key==="e"||t.key==="E"||!/[0-9]/.test(t.key)&&!t.ctrlKey&&!t.metaKey)&&t.preventDefault()}},C=t=>{t.preventDefault();const a=t.clipboardData.getData("text").replace(/[^0-9]/g,"");if(a){const l=(a.replace(/^0+/,"")||"0").slice(0,3);if(P(l),l&&l!=="0"){const E=parseInt(l,10);if(!isNaN(E)&&E>0){const K=Math.max(25,Math.min(500,E)),$=K/100;at($),P(K.toString()),dt(!1)}}}},Q=()=>{if(U.trim()===""||U==="0"){P(Math.round(r*100).toString()),dt(!1);return}const t=parseInt(U,10);if(isNaN(t)||t<=0){P(Math.round(r*100).toString()),dt(!1);return}const n=Math.max(25,Math.min(500,t)),a=n/100;at(a),P(n.toString()),dt(!1)};d.useEffect(()=>{rt&&M.current&&(M.current.focus(),M.current.select())},[rt]);const B=()=>{if(!pt.current||N.current.size===0)return;const t=pt.current.getBoundingClientRect();let n;n=t.width-40;const a=N.current.get(1);if(!a)return;const f=n/a.width,l=Math.max(.1,Math.min(f,5));at(l),P(Math.round(l*100).toString())},mt=()=>{if(!pt.current||N.current.size===0)return;const t=pt.current.getBoundingClientRect();let n=0,a=0;p.current&&(n=p.current.getBoundingClientRect().height),O.current&&(a=O.current.getBoundingClientRect().height);let f=0;const l=pt.current.querySelector(".annotation-toolbar");l&&(f=l.getBoundingClientRect().height);const E=t.height-n-a-f,K=N.current.get(s);if(!K)return;const $=E/K.height,Z=Math.max(.1,Math.min($,5));at(Z),P(Math.round(Z*100).toString())},st=d.useCallback(()=>{const t=window.getSelection();if(t&&t.toString().trim()){const n=t.toString().trim();let a,f;if(t.rangeCount>0&&J.current){const E=t.getRangeAt(0).getBoundingClientRect(),K=J.current.getBoundingClientRect(),$=E.top-K.top+J.current.scrollTop;for(let Z=1;Z<=R;Z++){const ot=A.current.get(Z);if(ot){const ct=ot.offsetTop,Y=ot.offsetHeight,I=ct+Y;if($>=ct&&$<=I){f=Z;const L=($-ct)/Y;a=Math.max(0,Math.min(1,L));break}}}}T(n,f,a)}else T("",void 0,void 0)},[T,R]),vt=d.useCallback(t=>{const n=t.target;if(n.closest(".textbox-controls")!==null||n.closest(".textbox-font-size-input")!==null||n.closest(".textbox-color-button")!==null||n.closest(".textbox-color-picker")!==null||n.classList.contains("textbox-controls")||n.classList.contains("textbox-font-size-input")||n.classList.contains("textbox-color-button")||n.classList.contains("textbox-color-picker"))return;const f=n.closest(".annotation")!==null||n.closest(".annotation-layer")!==null||n.closest(".resize-handle")!==null||n.closest(".rotate-handle")!==null||n.closest(".delete-button")!==null||n.classList.contains("annotation")||n.classList.contains("annotation-layer")||n.classList.contains("resize-handle")||n.classList.contains("rotate-handle")||n.classList.contains("delete-button");setTimeout(()=>{const l=window.getSelection(),E=l&&l.toString().trim().length>0;if(E||T(""),!f&&!E&&tt(null),yt==="textbox"&&!f&&!E){const K=J.current;if(!K)return;let $=s,Z=.5,ot=.5;for(let Y=1;Y<=R;Y++){const I=A.current.get(Y);if(I){const L=I.getBoundingClientRect();if(K.getBoundingClientRect()){const it=t.clientX-L.left,gt=t.clientY-L.top;if(it>=0&&it<=L.width&&gt>=0&&gt<=L.height){$=Y;const et=N.current.get(Y);if(et){const ft=L.width/et.width,Mt=L.height/et.height;Z=it/(et.width*ft),ot=gt/(et.height*Mt),console.log(`[Text Box Creation] Page ${$}:`,{pageRelativeX:it,pageRelativeY:gt,pageRectWidth:L.width,pageRectHeight:L.height,baseWidth:et.width,baseHeight:et.height,stateScale:r,actualScaleX:ft,actualScaleY:Mt,relativeX:Z,relativeY:ot,calculatedRelativeX:it/(et.width*ft),calculatedRelativeY:gt/(et.height*Mt),predictedSavedPdfX:Z*et.width,predictedSavedPdfY:ot*et.height,expectedPdfX:it/ft,expectedPdfY:gt/Mt,matches:Math.abs(Z*et.width-it/ft)<.1})}break}}}}if(N.current.get($)){const Y=Math.max(0,Math.min(.8,Z-.1)),I=Math.max(0,Math.min(1-.1,ot-.05)),L={id:`textbox-${Date.now()}`,type:"textbox",pageNumber:$,x:Y,y:I,width:.2,height:.1,rotation:0,text:"Text",fontSize:16,color:Yt[0]};D(xt=>[...xt,L]),tt(L.id),F("select")}}},100)},[T,yt,s,R,r,tt,F,D]),ut=d.useCallback(t=>{D(n=>[...n,t]),tt(t.id)},[]);d.useEffect(()=>(k&&(window.__addPDFAnnotation=t=>{D(n=>[...n,t]),tt(t.id),t.pageNumber&&v&&v(t.pageNumber)}),()=>{delete window.__addPDFAnnotation}),[k,v]);const kt=d.useCallback((t,n,a)=>{const f=t.width*n.width*a,l=document.createElement("div");l.style.position="absolute",l.style.visibility="hidden",l.style.width=`${f}px`,l.style.fontSize=`${t.fontSize*a}px`,l.style.fontFamily="inherit",l.style.whiteSpace="pre-wrap",l.style.wordWrap="break-word",l.style.overflowWrap="break-word",l.style.padding=`${4*a}px`,l.style.boxSizing="border-box",l.style.lineHeight="1.2",l.textContent=t.text||"Text",document.body.appendChild(l);const E=l.scrollHeight;document.body.removeChild(l);const K=E/(n.height*a);return Math.max(.01,Math.min(1,K))},[]),Pt=d.useCallback(t=>{D(n=>{const a=n.map(f=>f.id===t.id?t:f);if(t.type==="textbox"){const f=t,l=N.current.get(f.pageNumber);if(l){const E=kt(f,l,r);return a.map(K=>K.id===t.id?{...f,height:E}:K)}}return a})},[r,kt]);d.useEffect(()=>{D(t=>t.map(n=>{if(n.type==="textbox"){const a=n,f=N.current.get(a.pageNumber);if(f){const l=kt(a,f,r);return{...a,height:l}}}return n}))},[r,kt]);const Lt=d.useCallback(t=>{D(n=>n.filter(a=>a.id!==t)),lt===t&&tt(null)},[lt]),Dt=d.useCallback(async t=>{if(!u||!N.current.get(s))return;const a=new FileReader;a.onload=f=>{const l=f.target?.result,E=new Image;E.onload=()=>{const Z=.2/(E.width/E.height),Y={id:`image-${Date.now()}`,type:"image",pageNumber:s,x:.4,y:.4,width:.2,height:Z,rotation:0,imageData:l,imageWidth:E.width,imageHeight:E.height};ut(Y),F("select")},E.src=l},a.readAsDataURL(t)},[u,s,ut,F]),Ft=d.useCallback(async()=>{if(!u||V.length===0){alert("No annotations to save");return}try{const t=await Gt(u,V,N.current),n=u.name.replace(".pdf","_annotated.pdf");Qt(t,n)}catch(t){console.error("Error saving PDF:",t),alert("Failed to save annotated PDF. Please check the console for details.")}},[u,V]),Tt=d.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy",wt(!0)},[]),Xt=d.useCallback(t=>{t.preventDefault(),t.stopPropagation(),J.current?.contains(t.relatedTarget)||wt(!1)},[]),$t=d.useCallback(async t=>{t.preventDefault(),t.stopPropagation();const a=Array.from(t.dataTransfer.files).filter($=>$.type.startsWith("image/"));if(a.length===0||!J.current?.getBoundingClientRect())return;let l=s,E=.5,K=.5;for(let $=1;$<=R;$++){const Z=A.current.get($);if(Z){const ot=Z.getBoundingClientRect();if(J.current?.getBoundingClientRect()){const Y=t.clientX-ot.left,I=t.clientY-ot.top;if(Y>=0&&Y<=ot.width&&I>=0&&I<=ot.height){l=$;const L=N.current.get($);L&&(E=Y/(L.width*r),K=I/(L.height*r));break}}}}for(const $ of a){const Z=new FileReader;Z.onload=ot=>{const ct=ot.target?.result,Y=new Image;Y.onload=()=>{if(!N.current.get(l))return;const L=.2,xt=Y.width/Y.height,it=L/xt,gt=Math.max(0,Math.min(1-L,E-L/2)),et=Math.max(0,Math.min(1-it,K-it/2)),ft={id:`image-${Date.now()}-${Math.random()}`,type:"image",pageNumber:l,x:gt,y:et,width:L,height:it,rotation:0,imageData:ct,imageWidth:Y.width,imageHeight:Y.height};ut(ft)},Y.src=ct},Z.readAsDataURL($)}},[s,R,r,ut]);if(!u)return e.jsx("div",{className:`pdf-viewer-empty ${m==="floating"?"float-layout":""}`,children:e.jsxs("div",{className:"upload-container",children:[e.jsx("label",{htmlFor:"pdf-upload",className:"upload-button",children:"Upload PDF"}),e.jsx("input",{id:"pdf-upload",type:"file",accept:"application/pdf",onChange:o,style:{display:"none"}})]})});const Wt=V.find(t=>t.id===lt)||null;return e.jsxs("div",{className:"pdf-viewer",ref:pt,children:[e.jsx(Ut,{mode:yt,onModeChange:F,onImageUpload:Dt,onDownload:Ft,onClearAll:()=>{D([]),tt(null)}}),e.jsxs("div",{className:"pdf-controls-top",ref:p,children:[Wt&&Wt.type==="textbox"&&e.jsx(te,{selectedAnnotation:Wt,onUpdate:Pt}),e.jsxs("div",{className:"zoom-controls",children:[e.jsx("button",{onClick:B,className:"control-button fit-button",title:"Fit to width",children:"↔"}),e.jsx("button",{onClick:mt,className:"control-button fit-button",title:"Fit to height",children:"↕"}),e.jsx("button",{onClick:x,className:"control-button",children:"−"}),rt?e.jsx("input",{ref:M,type:"text",inputMode:"numeric",pattern:"[0-9]*",value:U,onChange:w,onBlur:H,onKeyDown:X,onPaste:C,className:"zoom-input"}):e.jsxs("span",{className:"zoom-level",onClick:b,title:"Click to edit zoom level",children:[Math.round(r*100),"%"]}),e.jsx("button",{onClick:h,className:"control-button",children:"+"}),c&&e.jsx("button",{onClick:c,className:"control-button knowledge-notes-toggle",title:i?"Hide knowledge notes":"Show knowledge notes",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})})]})]}),e.jsx("div",{ref:J,className:`pdf-content ${ht?"drag-over":""}`,onMouseUp:st,onKeyUp:st,onClick:vt,onDragOver:Tt,onDragLeave:Xt,onDrop:t=>{wt(!1),$t(t)},children:e.jsx(At,{file:bt||u,onLoadSuccess:jt,onLoadError:zt,loading:e.jsx("div",{className:"loading",children:"Loading PDF..."}),error:e.jsxs("div",{className:"error",children:["Failed to load PDF. Please check the console for details.",e.jsx("br",{}),e.jsxs("small",{children:["Worker: ",Rt?.workerSrc||"Not set"]})]}),noData:e.jsx("div",{className:"loading",children:"No PDF file selected"}),options:St,children:Array.from(new Array(R),(t,n)=>{const a=n+1,f=N.current.get(a);return e.jsxs("div",{ref:l=>{l?A.current.set(a,l):A.current.delete(a)},className:"pdf-page-wrapper",style:{position:"relative"},children:[e.jsx(Ot,{pageNumber:a,scale:r,renderTextLayer:!0,renderAnnotationLayer:!0,onLoadSuccess:l=>Nt({pageNumber:a,page:l})},`page_${a}`),f&&e.jsxs(e.Fragment,{children:[e.jsx(_t,{pageNumber:a,pageWidth:f.width,pageHeight:f.height,scale:r,annotations:V,selectedAnnotationId:lt,onAnnotationUpdate:Pt,onAnnotationDelete:Lt,onAnnotationSelect:tt,mode:yt}),i&&e.jsx(Vt,{pageNumber:a,pageWidth:f.width,pageHeight:f.height,scale:r,knowledgeNotes:g,showKnowledgeNotes:i,layout:m,onNoteClick:G})]})]},`page-wrapper-${a}`)})})}),e.jsxs("div",{className:"pdf-controls-bottom",ref:O,children:[e.jsx("button",{onClick:W,disabled:s<=1,className:"nav-button",children:"Previous"}),e.jsxs("span",{className:"page-info",children:["Page ",s," of ",R]}),e.jsx("button",{onClick:y,disabled:s>=R,className:"nav-button",children:"Next"})]})]})}export{se as default};
